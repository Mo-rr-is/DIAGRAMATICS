class t{constructor(t,e){this.x=t,this.y=e}add(e){return new t(this.x+e.x,this.y+e.y)}sub(e){return new t(this.x-e.x,this.y-e.y)}scale(e){return new t(this.x*e,this.y*e)}mul(e){return new t(this.x*e.x,this.y*e.y)}rotate(e){let n=this.x*Math.cos(e)-this.y*Math.sin(e),r=this.x*Math.sin(e)+this.y*Math.cos(e);return new t(n,r)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}equals(t){return this.x==t.x&&this.y==t.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}length_sq(){return this.x*this.x+this.y*this.y}angle(){return Math.atan2(this.y,this.x)}normalize(){let e=this.length();return new t(this.x/e,this.y/e)}copy(){return new t(this.x,this.y)}apply(t){return t(this.copy())}}function e(e,n){return new t(e,n)}function n(e){return new t(Math.cos(e),Math.sin(e))}class r{static translate(t){return e=>e.add(t)}static rotate(t,e){return n=>n.sub(e).rotate(t).add(e)}static scale(t,e){return n=>n.sub(e).mul(t).add(e)}static reflect_over_point(t){return e=>e.sub(t).rotate(Math.PI).add(t)}static reflect_over_line(t,e){let n=e.sub(t).rotate(Math.PI/2).normalize();return e=>{let r=n.dot(e.sub(t));return e.sub(n.scale(2*r))}}static skewX(e,n){return r=>{let i=r.x+(n-r.y)*Math.tan(e);return new t(i,r.y)}}static skewY(e,n){return r=>{let i=r.y+(n-r.x)*Math.tan(e);return new t(r.x,i)}}}var i,a,l;!function(t){t.TEXT="TEXT",t.OPEN_TAG="OPEN_TAG",t.CLOSE_TAG="CLOSE_TAG",t.EOF="EOF"}(i||(i={}));class s{static parse_tag_content(t){if("/"===t[0]){let e=t.substring(1);return{type:i.CLOSE_TAG,attributes:{_tag_name:e}}}let e=t.indexOf(" "),n=t.indexOf("=");if(-1===e&&-1===n)return{type:i.OPEN_TAG,attributes:{_tag_name:t}};if(-1===e&&n>0){let e=t.substring(0,n),r=t.substring(n+1),a={_tag_name:e};return a[e]=r,{type:i.OPEN_TAG,attributes:a}}throw new Error("Unimplemented")}static parse(t){let e=[],n=0,r=t.length;for(;n<r;){let r=t.indexOf("[",n);if(-1===r){e.push({type:i.TEXT,attributes:{_text:t.substring(n)}});break}r>n&&e.push({type:i.TEXT,attributes:{_text:t.substring(n,r)}});let a=t.indexOf("]",r),l=t.indexOf("[",r+1);if(l>0&&l<a)return null;if(-1===a)return null;let o=t.substring(r+1,a);e.push(s.parse_tag_content(o)),n=a+1}return e}}class o{static from_BBCode(t,e="1em"){let n=[],r=[],a=s.parse(t);if(null!==a){for(let t of a)switch(t.type){case i.OPEN_TAG:if("br"===t.attributes._tag_name){n.push({text:"\n",style:{dy:e}});break}r.push(t.attributes);break;case i.CLOSE_TAG:if(0===r.length)return void console.error("Invalid BBCode");if(r[r.length-1]._tag_name!==t.attributes._tag_name)return void console.error("Invalid BBCode");r.pop();break;case i.TEXT:{let e=o.build_style(r);n.push({text:t.attributes._text,style:e})}}return n}console.error("Invalid BBCode")}static build_style(t){let e={};for(let n of t)switch(n._tag_name){case"b":e["font-weight"]="bold";break;case"i":e["font-style"]="italic";break;case"color":e.fill=n.color;break;case"size":e["font-size"]=n.size;break;case"dx":e.dx=n.dx;break;case"dy":e.dy=n.dy;break;case"font":e["font-family"]=n.font;break;case"var":e.textvar=!0;break;case"tag":e.tag=n.tag}return e}}!function(t){t.LINE="line",t.CIRCLE="circle",t.TEXTVAR="textvar",t.ROW_="row_",t.COL_="col_",t.ARROW_LINE="arrow_line",t.ARROW_HEAD="arrow_head",t.TABLE="table",t.CONTAIN_TABLE="contain_table",t.TABLE_CELL="table_cell",t.TABLE_CONTENT="table_content",t.GRAPH_AXIS="graph_axis_line",t.GRAPH_TICK="graph_tick",t.GRAPH_TICK_LABEL="graph_tick_label",t.GRAPH_GRID="graph_grid"}(a||(a={})),function(t){t.Polygon="polygon",t.Curve="curve",t.Text="text",t.Image="image",t.Diagram="diagram",t.MultilineText="multilinetext"}(l||(l={}));const c="16";class h{constructor(e,n={}){this.children=[],this.path=void 0,this.origin=new t(0,0),this.style={},this.textdata={},this.multilinedata={},this.imgdata={},this.mutable=!1,this.tags=[],this.type=e,this.path=n.path,n.children&&(this.children=n.children),n.textdata&&(this.textdata=n.textdata),n.imgdata&&(this.imgdata=n.imgdata),n.tags&&(this.tags=n.tags),n.multilinedata&&(this.multilinedata=n.multilinedata)}mut(){this.mutable=!0,null!=this.path&&(this.path.mutable=!0);for(let t=0;t<this.children.length;t++)this.children[t].mut();return this}mut_parent_only(){return this.mutable=!0,null!=this.path&&(this.path.mutable=!0),this}immut(){let t=this.copy();t.mutable=!1,null!=this.path&&(this.path.mutable=!1);for(let e=0;e<t.children.length;e++)t.children[e].immut();return t}static deep_setPrototypeOf(e){Object.setPrototypeOf(e,h.prototype);let n=e;n.origin=Object.setPrototypeOf(n.origin,t.prototype);for(let t=0;t<n.children.length;t++)h.deep_setPrototypeOf(n.children[t]);null!=n.path&&(Object.setPrototypeOf(n.path,u.prototype),n.path=n.path.copy())}copy(){let t=JSON.parse(JSON.stringify(this));return h.deep_setPrototypeOf(t),t}copy_if_not_mutable(){return this.mutable?this:this.copy()}append_tags(t){let e=this.copy_if_not_mutable();Array.isArray(t)||(t=[t]);for(let n of t)e.tags.includes(n)||e.tags.push(n);return e}remove_tags(t){let e=this.copy_if_not_mutable();return e.tags=e.tags.filter((e=>!t.includes(e))),e}reset_tags(){let t=this.copy_if_not_mutable();return t.tags=[],t}contain_tag(t){return this.tags.includes(t)}contain_all_tags(t){for(let e of t)if(!this.tags.includes(e))return!1;return!0}collect_children(){let t=[];if(this.type==l.Diagram)for(let e of this.children)t=t.concat(e.collect_children());else t.push(this);return t}flatten(){let t=this.copy_if_not_mutable();return t.children=t.collect_children(),t}apply(t){return t(this.copy_if_not_mutable())}apply_recursive(t){let e=this.copy_if_not_mutable();e=t(e);for(let n=0;n<e.children.length;n++)e.children[n]=e.children[n].apply_recursive(t);return e}apply_to_tagged_recursive(t,e){Array.isArray(t)||(t=[t]);let n=this.copy_if_not_mutable();n.contain_all_tags(t)&&(n=e(n));for(let r=0;r<n.children.length;r++)n.children[r]=n.children[r].apply_to_tagged_recursive(t,e);return n}combine(...t){return d(this,...t)}to_curve(){let t=this.copy_if_not_mutable();if(t.type==l.Polygon)t.type=l.Curve;else if(t.type==l.Diagram)for(let e=0;e<t.children.length;e++)t.children[e]=t.children[e].to_curve();return t}to_polygon(){let t=this.copy_if_not_mutable();if(t.type==l.Curve)t.type=l.Polygon;else if(t.type==l.Diagram)for(let e=0;e<t.children.length;e++)t.children[e]=t.children[e].to_polygon();return t}add_points(t){let e=this.copy_if_not_mutable();if(e.type==l.Polygon||e.type==l.Curve){if(null==e.path)throw new Error(this.type+" must have a path");e.path=e.path.add_points(t)}else if(e.type==l.Diagram){let n=e.children[e.children.length-1];e.children[e.children.length-1]=n.add_points(t)}return e}update_style(t,e,n){let r=this.copy_if_not_mutable();if(null==n?void 0:n.includes(r.type))return r;if(r.type==l.Polygon||r.type==l.Curve||r.type==l.Text||r.type==l.Image||r.type==l.MultilineText)r.style[t]=e;else{if(r.type!=l.Diagram)throw new Error("Unreachable, unknown diagram type : "+r.type);for(let i=0;i<r.children.length;i++)r.children[i]=r.children[i].update_style(t,e,n)}return r}clone_style_from(t){return this.apply_recursive((e=>(e.style=Object.assign({},t.style),e)))}fill(t){return this.update_style("fill",t,[l.Text])}stroke(t){return this.update_style("stroke",t,[l.Text])}opacity(t){return this.update_style("opacity",t.toString())}strokewidth(t){return this.update_style("stroke-width",t.toString(),[l.Text])}strokelinecap(t){return this.update_style("stroke-linecap",t)}strokelinejoin(t){return this.update_style("stroke-linejoin",t)}strokedasharray(t){return this.update_style("stroke-dasharray",t.join(","))}vectoreffect(t){return this.update_style("vector-effect",t)}textfill(t){return this.update_style("fill",t,[l.Polygon,l.Curve])}textstroke(t){return this.update_style("stroke",t,[l.Polygon,l.Curve])}textstrokewidth(t){return this.update_style("stroke-width",t.toString(),[l.Polygon,l.Curve])}update_textdata(t,e){let n=this.copy_if_not_mutable();if(n.type==l.Text||n.type==l.MultilineText)n.textdata[t]=e;else if(n.type==l.Diagram)for(let r=0;r<n.children.length;r++)n.children[r]=n.children[r].update_textdata(t,e);else if(n.type!=l.Polygon&&n.type!=l.Curve)throw new Error("Unreachable, unknown diagram type : "+n.type);return n}fontfamily(t){return this.update_textdata("font-family",t)}fontstyle(t){return this.update_textdata("font-style",t)}fontsize(t){return this.update_textdata("font-size",t.toString())}fontweight(t){return this.update_textdata("font-weight",t.toString())}fontscale(t){return this.update_textdata("font-scale",t.toString())}textanchor(t){return this.update_textdata("text-anchor",t)}textdy(t){return this.update_textdata("dy",t)}textangle(t){return this.update_textdata("angle",t.toString())}text_tovar(){let t=this.copy_if_not_mutable();if(t.type==l.Text)t=t.append_tags(a.TEXTVAR);else if(t.type==l.Diagram)for(let e=0;e<t.children.length;e++)t.children[e]=t.children[e].text_tovar();return t}text_totext(){let t=this.copy_if_not_mutable();if(t.type==l.Text)t=t.remove_tags("textvar");else if(t.type==l.Diagram)for(let e=0;e<t.children.length;e++)t.children[e]=t.children[e].text_totext();return t}bounding_box(){let e=1/0,n=1/0,r=-1/0,i=-1/0;if(this.type==l.Diagram){for(let t=0;t<this.children.length;t++){let a=this.children[t],[l,s]=a.bounding_box();e=Math.min(e,l.x),n=Math.min(n,l.y),r=Math.max(r,s.x),i=Math.max(i,s.y)}return[new t(e,n),new t(r,i)]}if(this.type==l.Curve||this.type==l.Polygon||this.type==l.Image){if(null==this.path)throw new Error(this.type+" must have a path");for(let t=0;t<this.path.points.length;t++){let a=this.path.points[t];e=Math.min(e,a.x),n=Math.min(n,a.y),r=Math.max(r,a.x),i=Math.max(i,a.y)}return[new t(e,n),new t(r,i)]}if(this.type==l.Text||this.type==l.MultilineText)return[this.origin.copy(),this.origin.copy()];throw new Error("Unreachable, unknown diagram type : "+this.type)}transform(t){let e=this.copy_if_not_mutable();for(let n=0;n<e.children.length;n++)e.children[n]=e.children[n].transform(t);return null!=e.path&&(e.path=e.path.transform(t)),e.origin=t(e.origin),e}translate(t){return this.transform(r.translate(t))}position(e=new t(0,0)){let n=e.sub(this.origin);return this.translate(n)}rotate(t,e=void 0){return null==e&&(e=this.origin),this.transform(r.rotate(t,e))}scale(e,n){return null==n&&(n=this.origin),"number"==typeof e&&(e=new t(e,e)),this.transform(r.scale(e,n))}scaletext(t){return this.apply_recursive((e=>{switch(e.type){case l.Text:{let n=parseFloat(e.textdata["font-size"]||c),r=e.copy_if_not_mutable();return r.textdata["font-size"]=(n*t).toString(),r}case l.MultilineText:{let n=e.copy_if_not_mutable();return n.multilinedata["scale-factor"]=(n.multilinedata["scale-factor"]||1)*t,n}default:return e}}))}skewX(t,e){return null==e&&(e=this.origin),this.transform(r.skewX(t,e.y))}skewY(t,e){return null==e&&(e=this.origin),this.transform(r.skewY(t,e.x))}reflect_over_point(t){return this.transform(r.reflect_over_point(t))}reflect_over_line(t,e){return this.transform(r.reflect_over_line(t,e))}reflect(t,e){if(null==t&&null==e)return this.reflect_over_point(this.origin);if(null!=t&&null==e)return this.reflect_over_point(t);if(null!=t&&null!=e)return this.reflect_over_line(t,e);throw new Error("Unreachable")}vflip(e){return null==e&&(e=this.origin.y),this.reflect(new t(0,e),new t(1,e))}hflip(e){return null==e&&(e=this.origin.x),this.reflect(new t(e,0),new t(e,1))}get_anchor(e){let[n,r]=this.bounding_box(),i=n.x,a=n.y,l=r.x,s=r.y,o=(i+l)/2,c=(a+s)/2;switch(e){case"top-left":return new t(i,s);case"top-center":return new t(o,s);case"top-right":return new t(l,s);case"center-left":return new t(i,c);case"center-center":return new t(o,c);case"center-right":return new t(l,c);case"bottom-left":return new t(i,a);case"bottom-center":return new t(o,a);case"bottom-right":return new t(l,a);default:throw new Error("Unknown anchor "+e)}}move_origin(e){let n=this.copy_if_not_mutable();return n.origin=e instanceof t?e:n.get_anchor(e),n}__move_origin_text(t){let e=this.copy_if_not_mutable(),n=function(t){switch(t){case"top-left":return{"text-anchor":"start",dy:"0.75em"};case"top-center":return{"text-anchor":"middle",dy:"0.75em"};case"top-right":return{"text-anchor":"end",dy:"0.75em"};case"center-left":return{"text-anchor":"start",dy:"0.25em"};case"center-center":return{"text-anchor":"middle",dy:"0.25em"};case"center-right":return{"text-anchor":"end",dy:"0.25em"};case"bottom-left":return{"text-anchor":"start",dy:"-0.25em"};case"bottom-center":return{"text-anchor":"middle",dy:"-0.25em"};case"bottom-right":return{"text-anchor":"end",dy:"-0.25em"};default:throw new Error("Unknown anchor "+t)}}(t);return e.textdata["text-anchor"]=n["text-anchor"],e.textdata.dy=n.dy,e}move_origin_text(t){let e=this.copy_if_not_mutable();if(this.type==l.Text||this.type==l.MultilineText)e=e.__move_origin_text(t);else if(this.type==l.Diagram)for(let n=0;n<e.children.length;n++)e.children[n]=e.children[n].move_origin_text(t);return e}path_length(){if(this.type==l.Diagram){let t=0;for(let e=0;e<this.children.length;e++)t+=this.children[e].path_length();return t}if(this.type==l.Curve||this.type==l.Polygon){if(null==this.path)throw new Error(this.type+" must have a path");return this.path.length()}throw new Error("Unreachable, unknown diagram type : "+this.type)}reverse_path(){var t;let e=this.copy_if_not_mutable();return e.path&&(e.path=null===(t=e.path)||void 0===t?void 0:t.reverse()),e}parametric_point(t,e){if(this.type==l.Diagram){let e=[],n=0;for(let t=0;t<this.children.length;t++)n+=this.children[t].path_length(),e.push(n);let r=n,i=e.map((t=>t/r));for(let e=0;e<i.length;e++)if(t<=i[e]){let n=e,r=0==e?0:i[e-1],a=(t-r)/(i[e]-r);return this.children[n].parametric_point(a)}throw Error("Unreachable")}if(this.type==l.Curve){if(null==this.path)throw new Error(this.type+" must have a path");return this.path.parametric_point(t,!1,e)}if(this.type==l.Polygon){if(null==this.path)throw new Error(this.type+" must have a path");return this.path.parametric_point(t,!0,e)}throw new Error("Unreachable, unknown diagram type : "+this.type)}debug_bbox(){let[e,n]=this.bounding_box(),r=_([new t(e.x,e.y),new t(n.x,e.y),new t(n.x,n.y),new t(e.x,n.y)]).apply((t=>t.fill("none").stroke("gray").strokedasharray([5,5]))),i=m("+").position(this.origin);return r.combine(i)}debug(t=!0){let e=t=>t.fill("none").stroke("red").strokedasharray([5,5]),n=t=>{let e=t.textfill("white").textstroke("white").textstrokewidth(5),n=t.fill("black");return e.combine(n)};if(this.type==l.Diagram)return this.debug_bbox();if(this.type==l.Text)return f(this.origin);if(this.type==l.Polygon||this.type==l.Curve||this.type==l.Image){let r=this.type==l.Polygon||l.Image?_:g,i=this.debug_bbox();if(null==this.path)throw new Error(this.type+" must have a path");let a=r(this.path.points).apply(e);if(0==t)return i.combine(a);let s,o=this.path.points,c=[],[h,u]=this.bounding_box(),d=Math.min(u.x-h.x,u.y-h.y)/10;for(let t=0;t<o.length;t++){(null==s?1/0:o[t].sub(s).length())<d||(c.push(m(t.toString()).position(o[t]).apply(n)),s=o[t])}return i.combine(a,...c)}throw new Error("Unreachable, unknown diagram type : "+this.type)}}class u{constructor(t){this.points=t,this.mutable=!1}copy(){let e=this.points.map((e=>new t(e.x,e.y)));return new u(e)}copy_if_not_mutable(){return this.mutable?this:this.copy()}reverse(){let t=this.copy_if_not_mutable();return t.points=t.points.reverse(),t}length(){let t=0;for(let e=1;e<this.points.length;e++)t+=this.points[e].sub(this.points[e-1]).length();return t}add_points(t){let e=this.copy_if_not_mutable();return e.points=e.points.concat(t),e}parametric_point(t,e=!1,n){let r=this.points;if(e&&(r=this.points.concat(this.points[0])),null==n){if(t<0||t>1)throw Error("t must be between 0 and 1");let n=[],i=0;for(let t=1;t<r.length;t++)i+=r[t].sub(r[t-1]).length(),n.push(i);let a=i,l=n.map((t=>t/a));for(let n=0;n<l.length;n++)if(t<=l[n]){let r=n,i=0==n?0:l[n-1],a=(t-i)/(l[n]-i);return this.parametric_point(a,e,r)}throw Error("Unreachable")}{if(n<0||n>r.length-1)throw Error("segment_index must be between 0 and n-1");let e=r[n],i=r[n+1].sub(e);return e.add(i.scale(t))}}transform(t){let e=this.copy_if_not_mutable();for(let n=0;n<e.points.length;n++)e.points[n]=t(e.points[n]);return e}}function d(...t){if(0==t.length)return f();let e=t.map((t=>t.copy_if_not_mutable())),n=!0;for(let t=0;t<e.length;t++)if(!e[t].mutable){n=!1;break}let r=new h(l.Diagram,{children:e});return r.mutable=n,r.move_origin(t[0].origin)}function g(t){let e=new u(t);return new h(l.Curve,{path:e})}function p(t,e){return g([t,e]).append_tags(a.LINE)}function _(t){!function(t,e){if(!t)throw new Error(e)}(t.length>=3,"Polygon must have at least 3 points");let e=new u(t);return new h(l.Polygon,{path:e})}function f(t=e(0,0)){return g([t])}function m(e){return new h(l.Text,{textdata:{text:e,"font-size":c},path:new u([new t(0,0)])})}function b(t,n,r){let i={src:t},a=new u([e(-n/2,-r/2),e(n/2,-r/2),e(n/2,r/2),e(-n/2,r/2)]);return new h(l.Image,{imgdata:i,path:a})}function v(e){var n;let r=[];for(let t=0;t<e.length;t++){let i=e[t][0],a=null!==(n=e[t][1])&&void 0!==n?n:{};r.push({text:i,style:a})}return new h(l.MultilineText,{multilinedata:{content:r,"scale-factor":1},path:new u([new t(0,0)])})}function y(e,n){let r=o.from_BBCode(e,n);return new h(l.MultilineText,{multilinedata:{content:r,"scale-factor":1},path:new u([new t(0,0)])})}function x(t){return t*Math.PI/180}function w(t){return 180*t/Math.PI}function k(t,e){let n=[];for(let r=0;r<e;r++)n.push(t[r%t.length]);return n}function A(t,e,n=100){let r=[],i=(e-t)/(n-1);for(let e=0;e<n;e++)r.push(t+i*e);return r}function E(t,e,n=100){let r=[],i=(e-t)/n;for(let e=0;e<n;e++)r.push(t+i*e);return r}function O(t,e,n=1){if(0==n)return[];if(Math.floor((e-t)/n)<=0)return[];let r=[];if(n>0)for(let i=t;i<e;i+=n)r.push(i);else for(let i=t;i>e;i+=n)r.push(i);return r}function L(t,e,n=1){if(0==n)return[];if(Math.floor((e-t)/n)<=0)return[];let r=[];if(n>0)for(let i=t;i<=e;i+=n)r.push(i);else for(let i=t;i>=e;i+=n)r.push(i);return r}function S(t){let e=[],n=Math.max(...t.map((t=>t.length)));for(let r=0;r<n;r++){e.push([]);for(let n=0;n<t.length;n++)e[r].push(t[n][r])}return e}function N(t){let e=t;return"number"==typeof e?[e,e,e,e]:Array.isArray(e)?1===e.length?[e[0],e[0],e[0],e[0]]:2===e.length?[e[0],e[1],e[0],e[1]]:3===e.length?[e[0],e[1],e[2],e[1]]:e.length>=4?[e[0],e[1],e[2],e[3]]:[0,0,0,0]:[0,0,0,0]}var M=Object.freeze({__proto__:null,array_repeat:k,expand_directional_value:N,linspace:A,linspace_exc:E,range:O,range_inc:L,to_degree:w,to_radian:x,transpose:S});const C={blue:"#1f77b4",lightblue:"#aec7e8",orange:"#ff7f0e",lightorange:"#ffbb78",green:"#2ca02c",lightgreen:"#98df8a",red:"#d62728",lightred:"#ff9896",purple:"#9467bd",lightpurple:"#c5b0d5",brown:"#8c564b",lightbrown:"#c49c94",pink:"#e377c2",lightpink:"#f7b6d2",grey:"#7f7f7f",lightgrey:"#c7c7c7",gray:"#7f7f7f",lightgray:"#c7c7c7",olive:"#bcbd22",lightolive:"#dbdb8d",cyan:"#17becf",lightcyan:"#9edae5"};function T(t,e){var n;return null!==(n=e[t])&&void 0!==n?n:t}const z={A:"𝐴",B:"𝐵",C:"𝐶",D:"𝐷",E:"𝐸",F:"𝐹",G:"𝐺",H:"𝐻",I:"𝐼",J:"𝐽",K:"𝐾",L:"𝐿",M:"𝑀",N:"𝑁",O:"𝑂",P:"𝑃",Q:"𝑄",R:"𝑅",S:"𝑆",T:"𝑇",U:"𝑈",V:"𝑉",W:"𝑊",X:"𝑋",Y:"𝑌",Z:"𝑍",a:"𝑎",b:"𝑏",c:"𝑐",d:"𝑑",e:"𝑒",f:"𝑓",g:"𝑔",h:"ℎ",i:"𝑖",j:"𝑗",k:"𝑘",l:"𝑙",m:"𝑚",n:"𝑛",o:"𝑜",p:"𝑝",q:"𝑞",r:"𝑟",s:"𝑠",t:"𝑡",u:"𝑢",v:"𝑣",w:"𝑤",x:"𝑥",y:"𝑦",z:"𝑧","Α":"𝛢","Β":"𝛣","Γ":"𝛤","Δ":"𝛥","Ε":"𝛦","Ζ":"𝛧","Η":"𝛨","Θ":"𝛩","Ι":"𝛪","Κ":"𝛫","Λ":"𝛬","Μ":"𝛭","Ν":"𝛮","Ξ":"𝛯","Ο":"𝛰","Π":"𝛱","Ρ":"𝛲","Σ":"𝛴","Τ":"𝛵","Υ":"𝛶","Φ":"𝛷","Χ":"𝛸","Ψ":"𝛹","Ω":"𝛺","α":"𝛼","β":"𝛽","γ":"𝛾","δ":"𝛿","ε":"𝜀","ζ":"𝜁","η":"𝜂","θ":"𝜃","ι":"𝜄","κ":"𝜅","λ":"𝜆","μ":"𝜇","ν":"𝜈","ξ":"𝜉","ο":"𝜊","π":"𝜋","ρ":"𝜌","ς":"𝜍","σ":"𝜎","τ":"𝜏","υ":"𝜐","φ":"𝜑","χ":"𝜒","ψ":"𝜓","ω":"𝜔","ϑ":"𝜗","ϰ":"𝜘","ϕ":"𝜙","ϱ":"𝜚","ϖ":"𝜛"};Object.fromEntries(Object.entries(z).map((([t,e])=>[e,t])));const j={"\\alpha":"α","\\beta":"β","\\gamma":"γ","\\delta":"δ","\\epsilon":"ε","\\zeta":"ζ","\\eta":"η","\\theta":"θ","\\iota":"ι","\\kappa":"κ","\\lambda":"λ","\\mu":"μ","\\nu":"ν","\\xi":"ξ","\\omicron":"ο","\\pi":"π","\\rho":"ρ","\\sigma":"σ","\\tau":"τ","\\upsilon":"υ","\\phi":"ϕ","\\chi":"χ","\\psi":"ψ","\\omega":"ω","\\vartheta":"ϑ","\\varchi":"ϰ","\\varphi":"φ","\\varepsilon":"ε","\\varrho":"ϱ","\\varsigma":"ς"},D={textfractionsolidus:"⁄",leftrightsquigarrow:"↭",textpertenthousand:"‱",blacktriangleright:"▸",blacktriangledown:"▾",blacktriangleleft:"◂",twoheadrightarrow:"↠",leftrightharpoons:"⇋",rightleftharpoons:"⇌",textreferencemark:"※",circlearrowright:"↻",rightrightarrows:"⇉",vartriangleright:"⊳",textordmasculine:"º",textvisiblespace:"␣",twoheadleftarrow:"↞",downharpoonright:"⇂",ntrianglerighteq:"⋭",rightharpoondown:"⇁",textperthousand:"‰",leftrightarrows:"⇆",textmusicalnote:"♪",nleftrightarrow:"↮",rightleftarrows:"⇄",bigtriangledown:"▽",textordfeminine:"ª",ntrianglelefteq:"⋬",rightthreetimes:"⋌",trianglerighteq:"⊵",vartriangleleft:"⊲",rightsquigarrow:"⇝",downharpoonleft:"⇃",curvearrowright:"↷",circlearrowleft:"↺",leftharpoondown:"↽",nLeftrightarrow:"⇎",curvearrowleft:"↶",guilsinglright:"›",leftthreetimes:"⋋",leftrightarrow:"↔",rightharpoonup:"⇀",guillemotright:"»",downdownarrows:"⇊",hookrightarrow:"↪",dashrightarrow:"⇢",leftleftarrows:"⇇",trianglelefteq:"⊴",ntriangleright:"⋫",doublebarwedge:"⌆",upharpoonright:"↾",rightarrowtail:"↣",looparrowright:"↬",Leftrightarrow:"⇔",sphericalangle:"∢",divideontimes:"⋇",measuredangle:"∡",blacktriangle:"▴",ntriangleleft:"⋪",mathchar1356:"⁁",texttrademark:"™",mathchar2208:"⌖",triangleright:"▹",leftarrowtail:"↢",guilsinglleft:"‹",upharpoonleft:"↿","mathbb{gamma}":"ℽ",fallingdotseq:"≒",looparrowleft:"↫",textbrokenbar:"¦",hookleftarrow:"↩",smallsetminus:"﹨",dashleftarrow:"⇠",guillemotleft:"«",leftharpoonup:"↼","mathbb{Gamma}":"ℾ",bigtriangleup:"△",textcircledP:"℗",risingdotseq:"≓",triangleleft:"◃",mathsterling:"£",textcurrency:"¤",triangledown:"▿",blacklozenge:"","sfrac{5}{6}":"⅚",preccurlyeq:"≼",Rrightarrow:"⇛",circledcirc:"⊚",nRightarrow:"⇏","sfrac{3}{8}":"⅜","sfrac{1}{3}":"⅓","sfrac{2}{5}":"⅖",vartriangle:"▵",Updownarrow:"⇕",nrightarrow:"↛","sfrac{1}{2}":"½","sfrac{3}{5}":"⅗",succcurlyeq:"≽","sfrac{4}{5}":"⅘",diamondsuit:"♦","sfrac{1}{6}":"⅙",curlyeqsucc:"⋟",blacksquare:"▪",curlyeqprec:"⋞","sfrac{1}{8}":"⅛","sfrac{7}{8}":"⅞","sfrac{1}{5}":"⅕","sfrac{2}{3}":"⅔",updownarrow:"↕",backepsilon:"∍",circleddash:"⊝",eqslantless:"⋜","sfrac{3}{4}":"¾","sfrac{5}{8}":"⅝","sfrac{1}{4}":"¼","mathbb{Pi}":"ℿ","mathcal{M}":"ℳ","mathcal{o}\t":"ℴ","mathcal{O}\t":"𝒪",nsupseteqq:"⊉","mathcal{B}":"ℬ",textrecipe:"℞",nsubseteqq:"⊈",subsetneqq:"⊊","mathcal{I}":"ℑ",upuparrows:"⇈","mathcal{e}":"ℯ","mathcal{L}":"ℒ",nleftarrow:"↚","mathcal{H}":"ℋ","mathcal{E}":"ℰ",eqslantgtr:"⋝",curlywedge:"⋏",varepsilon:"ε",supsetneqq:"⊋",rightarrow:"→","mathcal{R}":"ℛ",sqsubseteq:"⊑","mathcal{g}":"ℊ",sqsupseteq:"⊒",complement:"∁",Rightarrow:"⇒",gtreqqless:"⋛",lesseqqgtr:"⋚",circledast:"⊛",nLeftarrow:"⇍",Lleftarrow:"⇚",varnothing:"∅","mathcal{N}":"𝒩",Leftarrow:"⇐",gvertneqq:"≩","mathbb{C}":"ℂ",supsetneq:"⊋",leftarrow:"←",nleqslant:"≰","mathbb{Q}":"ℚ","mathbb{Z}":"ℤ",llbracket:"〚","mathbb{H}":"ℍ",spadesuit:"♠","mathit{o}":"ℴ","mathbb{P}":"ℙ",rrbracket:"〛",supseteqq:"⊇",copyright:"©","textsc{k}":"ĸ",gtreqless:"⋛","mathbb{j}":"ⅉ",pitchfork:"⋔",estimated:"℮",ngeqslant:"≱","mathbb{e}":"ⅇ",therefore:"∴",triangleq:"≜",varpropto:"∝",subsetneq:"⊊",heartsuit:"♥","mathbb{d}":"ⅆ",lvertneqq:"≨",checkmark:"✓",nparallel:"∦","mathbb{R}":"ℝ",lesseqgtr:"⋚",downarrow:"↓","mathbb{D}":"ⅅ","mathbb{i}":"ⅈ",backsimeq:"⋍","mathbb{N}":"ℕ",Downarrow:"⇓",subseteqq:"⊆",setminus:"∖",succnsim:"⋩",doteqdot:"≑",clubsuit:"♣",emptyset:"∅",sqsupset:"⊐","fbox{~~}":"▭",curlyvee:"⋎",varkappa:"ϰ",llcorner:"⌞",varsigma:"ς",approxeq:"≊",backcong:"≌",supseteq:"⊇",circledS:"Ⓢ",circledR:"®",textcent:"¢",urcorner:"⌝",lrcorner:"⌟",boxminus:"⊟",texteuro:"€",vartheta:"ϑ",barwedge:"⊼","ding{86}":"✶",sqsubset:"⊏",subseteq:"⊆",intercal:"⊺","ding{73}":"☆",ulcorner:"⌜",recorder:"⌕",precnsim:"⋨",parallel:"∥",boxtimes:"⊠","ding{55}":"✗",multimap:"⊸",maltese:"✠",nearrow:"↗",swarrow:"↙",lozenge:"◊","sqrt[3]":"∛",succsim:"≿",dotplus:"∔","tilde{}":"~","check{}":"ˇ",lessgtr:"≶",Upsilon:"ϒ",Cdprime:"Ъ",gtrless:"≷",backsim:"∽",nexists:"∄",searrow:"↘",lessdot:"⋖",boxplus:"⊞",upsilon:"υ",epsilon:"ε",diamond:"⋄",bigstar:"★",ddagger:"‡",cdprime:"ъ",Uparrow:"⇑","sqrt[4]":"∜",between:"≬",sqangle:"∟",digamma:"Ϝ",uparrow:"↑",nwarrow:"↖",precsim:"≾","breve{}":"˘",because:"∵",bigcirc:"◯","acute{}":"´","grave{}":"`",lesssim:"≲",partial:"∂",natural:"♮",supset:"⊃",hstrok:"ħ",Tstrok:"Ŧ",coprod:"∐",models:"⊧",otimes:"⊗",degree:"°",gtrdot:"⋗",preceq:"≼",Lambda:"Λ",lambda:"λ",cprime:"ь",varrho:"ϱ",Bumpeq:"≎",hybull:"⁃",lmidot:"ŀ",nvdash:"⊬",lbrace:"{",bullet:"•",varphi:"φ",bumpeq:"≏","ddot{}":"¨",Lmidot:"Ŀ",Cprime:"Ь",female:"♀",rtimes:"⋊",gtrsim:"≳",mapsto:"↦",daleth:"ℸ",square:"■",nVDash:"⊯",rangle:"⟩",tstrok:"ŧ",oslash:"⊘",ltimes:"⋉",lfloor:"⌊",marker:"▮",Subset:"⋐",Vvdash:"⊪",propto:"∝",Hstrok:"Ħ",dlcrop:"⌍",forall:"∀",nVdash:"⊮",Supset:"⋑",langle:"⟨",ominus:"⊖",rfloor:"⌋",circeq:"≗",eqcirc:"≖",drcrop:"⌌",veebar:"⊻",ulcrop:"⌏",nvDash:"⊭",urcrop:"⌎",exists:"∃",approx:"≈",dagger:"†",boxdot:"⊡",succeq:"≽",bowtie:"⋈",subset:"⊂",notin:"∉",Sigma:"Σ",Omega:"Ω",nabla:"∇",colon:":",boxHu:"╧",boxHd:"╤",aleph:"ℵ",gnsim:"⋧",boxHU:"╩",boxHD:"╦",equiv:"≡",lneqq:"≨",alpha:"α",amalg:"∐",boxhU:"╨",boxhD:"╥",uplus:"⊎",boxhu:"┴",kappa:"κ",sigma:"σ",boxDL:"╗",Theta:"Θ",Vdash:"⊩",boxDR:"╔",boxDl:"╖",sqcap:"⊓",boxDr:"╓","bar{}":"¯",dashv:"⊣",vDash:"⊨",boxdl:"┐",boxVl:"╢",boxVh:"╫",boxVr:"╟",boxdr:"┌",boxdL:"╕",boxVL:"╣",boxVH:"╬",boxVR:"╠",boxdR:"╒",theta:"θ",lhblk:"▄",uhblk:"▀",ldotp:".",ldots:"…",boxvL:"╡",boxvH:"╪",boxvR:"╞",boxvl:"┤",boxvh:"┼",boxvr:"├",Delta:"Δ",boxUR:"╚",boxUL:"╝",oplus:"⊕",boxUr:"╙",boxUl:"╜",doteq:"≐",happy:"㋡",varpi:"ϖ",smile:"☺",boxul:"┘",simeq:"≃",boxuR:"╘",boxuL:"╛",boxhd:"┬",gimel:"ℷ",Gamma:"Γ",lnsim:"⋦",sqcup:"⊔",omega:"ω",sharp:"♯",times:"×",block:"█","hat{}":"^",wedge:"∧",vdash:"⊢",angle:"∠",infty:"∞",gamma:"γ",asymp:"≍",rceil:"⌉","dot{}":"˙",lceil:"⌈",delta:"δ",gneqq:"≩",frown:"⌢",phone:"☎",vdots:"⋮",boxr:"└","k{i}":"į","`{I}":"Ì",perp:"⊥",'"{o}':"ö","={I}":"Ī","`{a}":"à","v{T}":"Ť",surd:"√","H{O}":"Ő",vert:"|","k{I}":"Į",'"{y}':"ÿ",'"{O}':"Ö","u{u}":"ў","u{G}":"Ğ",".{E}":"Ė",".{z}":"ż","v{t}":"ť",prec:"≺","H{o}":"ő",mldr:"…",cong:"≅",".{e}":"ė",star:"*",".{Z}":"Ż",geqq:"≧",cdot:"⋅",cdots:"…","`{U}":"Ù","v{L}":"Ľ","c{s}":"ş","~{A}":"Ã",Vert:"‖","k{e}":"ę",lnot:"¬",leqq:"≦",beta:"β",beth:"ℶ","~{n}":"ñ","u{i}":"й","c{S}":"Ş","c{N}":"Ņ","H{u}":"ű","v{n}":"ň","={U}":"Ū","~{O}":"Õ","v{E}":"Ě","H{U}":"Ű","v{N}":"Ň",prod:"∏","v{s}":"š",'"{U}':"Ü","c{n}":"ņ","k{U}":"Ų","c{R}":"Ŗ","~{o}":"õ","v{e}":"ě","v{S}":"Š","u{A}":"Ă",circ:"∘",'"{u}':"ü",flat:"♭","v{z}":"ž","r{U}":"Ů","`{O}":"Ò","={u}":"ū",oint:"∮","c{K}":"Ķ","k{u}":"ų","not<":"≮","not>":"≯","`{o}":"ò",'"{I}':"Ï","v{D}":"Ď",".{G}":"Ġ","r{u}":"ů","not=":"≠","`{u}":"ù","v{c}":"č","c{k}":"ķ",".{g}":"ġ",odot:"⊙","`{e}":"э","c{T}":"Ţ","v{d}":"ď",'"{e}':"ё","v{R}":"Ř","k{a}":"ą",nldr:"‥","`{A}":"À","~{N}":"Ñ",nmid:"∤",".{C}":"Ċ",zeta:"ζ","~{u}":"ũ","`{E}":"Э","~{a}":"ã","c{t}":"ţ","={o}":"ō","v{r}":"ř","={A}":"Ā",".{c}":"ċ","~{U}":"Ũ","k{A}":"Ą",'"{a}':"ä","u{U}":"Ў",iota:"ι","={O}":"Ō","c{C}":"Ç",gneq:"≩",boxH:"═",hbar:"ℏ",'"{A}':"Ä",boxv:"│",boxh:"─",male:"♂",sqrt:"√",succ:"≻","c{c}":"ç","v{l}":"ľ","u{a}":"ă","v{Z}":"Ž","c{G}":"Ģ","v{C}":"Č",lneq:"≨","{E}":"Ё","={a}":"ā","c{l}":"ļ","={E}":"Ē",boxV:"║","u{g}":"ğ","u{I}":"Й","c{L}":"Ļ","k{E}":"Ę",".{I}":"İ","~{I}":"Ĩ","c{r}":"ŗ","{Y}":"Ÿ","={e}":"ē",leq:"≤",Cup:"⋓",Psi:"Ψ",neq:"≠","k{}":"˛","={}":"‾","H{}":"˝",cup:"∪",geq:"≥",mho:"℧",Dzh:"Џ",cap:"∩",bot:"⊥",psi:"ψ",chi:"χ","c{}":"¸",Phi:"Φ",ast:"*",ell:"ℓ",top:"⊤",lll:"⋘",tau:"τ",Cap:"⋒",sad:"☹",iff:"⇔",eta:"η",eth:"ð","d{":"\ṭ",rho:"ρ",dzh:"џ",div:"÷",phi:"ϕ",Rsh:"↱",vee:"∨","b{}":"ˍ","t{":"\t͡",int:"∫",sim:"∼","r{}":"˚",Lsh:"↰",yen:"¥",ggg:"⋙",mid:"∣",sum:"∑",neg:"¬",Dz:"Ѕ",Re:"ℜ",oe:"œ",DH:"Ð",ll:"≪",ng:"ŋ",wr:"≀",wp:"℘","=I":"І",":)":"☺",":(":"☹",AE:"Æ",AA:"Å",ss:"ß",dz:"ѕ",ae:"æ",aa:"å",th:"þ",to:"→",Pi:"Π",mp:"∓",Im:"ℑ",pm:"±",pi:"π",'"I':"Ї",in:"∈",ni:"∋",ne:"≠",TH:"Þ",Xi:"Ξ",nu:"ν",NG:"Ŋ",":G":"㋡",xi:"ξ",OE:"Œ",gg:"≫",DJ:"Đ","=e":"є","=E":"Є",mu:"μ",dj:"đ",S:"§",P:"¶",O:"Ø",L:"Ł",o:"ø",l:"ł",h:"ℎ",i:"ℹ","'{Y}":"Ý","'{y}":"ý","'{L}":"Ĺ","'{e}":"é","'{l}":"ĺ","'{s}":"ś","'{z}":"ź","'{E}":"É","'{S}":"Ś","'{Z}":"Ź","'{R}":"Ŕ","'{A}":"Á","'{N}":"Ń","'{I}":"Í","'{n}":"ń","'{c}":"ć","'{u}":"ú","'{C}":"Ć","'{o}":"ó","'{a}":"á","'{O}":"Ó","'{g}":"ǵ","'{r}":"ŕ","'{U}":"Ú","'G":"Ѓ","'C":"Ћ","'K":"Ќ","'k":"ќ","'c":"ћ","'g":"ѓ"};function H(t){for(let e in j)t=t.replaceAll(e,j[e]);for(let e in D)t=t.replaceAll("\\"+e,D[e]);return t}function I(t){return[...H(t)].map((t=>z[t]||t)).join("")}const R={fill:"none",stroke:"black","stroke-width":"1","stroke-linecap":"butt","stroke-dasharray":"none","stroke-linejoin":"round","vector-effect":"non-scaling-stroke",opacity:"1"},q=Object.assign({},R),P={fill:"black",stroke:"none","stroke-width":"1","stroke-linecap":"butt","stroke-dasharray":"none","stroke-linejoin":"round","vector-effect":"non-scaling-stroke",opacity:"1"},G=Object.assign({},P),B={text:"","font-family":"Latin Modern Math, sans-serif","font-size":c,"font-weight":"normal","text-anchor":"middle",dy:"0.25em",angle:"0","font-style":"normal","font-scale":"auto"},V=Object.assign({},B);function U(){for(let t in R)R[t]=q[t];for(let t in P)P[t]=G[t];for(let t in B)B[t]=V[t]}const X=new Map;function F(t,e,n,r){let i=document.createElementNS("http://www.w3.org/2000/svg","image");if(i.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),null==e.imgdata.src)return;if(null==e.path)return;if(4!=e.path.points.length)return;let a=e.path.points[1].sub(e.path.points[0]).length(),l=e.path.points[2].sub(e.path.points[1]).length(),s=e.path.points[1].sub(e.path.points[0]).normalize(),o=e.path.points[3].sub(e.path.points[0]).normalize(),c=s.x,h=-s.y,u=-o.x,d=o.y,g=e.path.points[3].x,p=-e.path.points[3].y;n?function(t,e){if(/^data:image\/(png|jpeg|jpg|gif|svg\+xml);base64,/.test(e))return t.setAttribute("href",e),void t.setAttribute("xlink:href",e);if(X.has(e)){const n=X.get(e);if(!n)return;return t.setAttribute("href",n),void t.setAttribute("xlink:href",n)}let n=document.createElement("canvas"),r=n.getContext("2d"),i=new Image;i.crossOrigin="anonymous",i.onload=()=>{n.height=i.height,n.width=i.width,null==r||r.drawImage(i,0,0);const a=n.toDataURL("image/png");t.setAttribute("href",a),t.setAttribute("xlink:href",a),X.set(e,a),n.remove()},i.src=e}(i,e.imgdata.src):i.setAttribute("href",e.imgdata.src),i.setAttribute("width",a.toString()),i.setAttribute("height",l.toString()),i.setAttribute("transform",`matrix(${c} ${h} ${u} ${d} ${g} ${p})`),i.setAttribute("preserveAspectRatio","none"),null!=r&&i.setAttribute("_dg_tag",r),t.appendChild(i)}function $(t,e){if(t.type==e)return[t];if(t.type==l.Diagram){let n=[];for(let r of t.children)n=n.concat($(r,e));return n}return[]}function W(t,e){const n=N(null!=e?e:0);let r=t.getBBox(),i=t.width.baseVal.value-n[1]-n[3],a=t.height.baseVal.value-n[0]-n[2];return Math.max(r.width/i,r.height/a)}function K(t,e){var n;let r=[];for(let i in e.children){let a=e.children[i];a instanceof SVGElement&&(a.getAttribute("_dg_tag")==t&&r.push(a),(null===(n=a.children)||void 0===n?void 0:n.length)&&(r=r.concat(K(t,a))))}return r}function Y(t,e,n=!0,r=!1,i,s){if(e.type==l.Polygon)!function(t,e,n){let r=Object.assign(Object.assign({},R),e.style);r.fill=T(r.fill,C),r.stroke=T(r.stroke,C);let i=document.createElementNS("http://www.w3.org/2000/svg","polygon");for(let t in r)i.style[t]=r[t];if(null!=n&&i.setAttribute("_dg_tag",n),t.appendChild(i),null!=e.path)for(let n=0;n<e.path.points.length;n++){let r=e.path.points[n];var a=t.createSVGPoint();a.x=r.x,a.y=-r.y,i.points.appendItem(a)}}(t,e,s);else if(e.type==l.Curve)!function(t,e,n){let r=Object.assign(Object.assign({},R),e.style);r.fill="none",r.stroke=T(r.stroke,C);let i=document.createElementNS("http://www.w3.org/2000/svg","polyline");for(let t in r)i.style[t]=r[t];if(null!=n&&i.setAttribute("_dg_tag",n),t.appendChild(i),null!=e.path)for(let n=0;n<e.path.points.length;n++){let r=e.path.points[n];var a=t.createSVGPoint();a.x=r.x,a.y=-r.y,i.points.appendItem(a)}}(t,e,s);else if(e.type==l.Text||e.type==l.MultilineText);else if(e.type==l.Image)F(t,e,r,s);else if(e.type==l.Diagram)for(let n of e.children)Y(t,n,!1,r,void 0,s);else console.warn("Unreachable, unknown diagram type : "+e.type);if(n){null==i&&(i=W(t));let n=$(e,l.Text),r=$(e,l.MultilineText);!function(t,e,n,r){for(let i of e){let e=Object.assign(Object.assign({},P),i.style);e.fill=T(e.fill,C),e.stroke=T(e.stroke,C);let l=Object.assign(Object.assign({},B),i.textdata);if(null==i.path)throw new Error("Text must have a path");let s=document.createElementNS("http://www.w3.org/2000/svg","text"),o=i.path.points[0].x,c=-i.path.points[0].y,h=w(parseFloat(l.angle)),u="auto"==l["font-scale"]?n:parseFloat(l["font-scale"]),d=parseFloat(l["font-size"])*u;s.setAttribute("font-family",l["font-family"]),s.setAttribute("font-style",l["font-style"]),s.setAttribute("font-size",d.toString()),s.setAttribute("font-weight",l["font-weight"]),s.setAttribute("text-anchor",l["text-anchor"]),s.setAttribute("dy",l.dy),s.setAttribute("transform",`translate(${o} ${c}) rotate(${h}) `),null!=r&&s.setAttribute("_dg_tag",r),s.setAttribute("_x",o.toString()),s.setAttribute("_y",c.toString()),s.setAttribute("_angle",h.toString());for(let t in e)s.style[t]=e[t];let g=l.text;i.tags.includes(a.TEXTVAR)&&!Q(g)&&(g=I(g)),s.innerHTML=g,t.appendChild(s)}}(t,n,null!=i?i:1,s),function(t,e,n,r){var i,a,l,s;for(let o of e){if(null==o.path)throw new Error("Text must have a path");let e=document.createElementNS("http://www.w3.org/2000/svg","text"),c=o.path.points[0].x,h=-o.path.points[0].y,u=0,d=Object.assign(Object.assign(Object.assign({},B),{dy:"0","text-anchor":"start"}),o.textdata),g=d["font-size"];if(null==(null===(i=o.multilinedata)||void 0===i?void 0:i.content))throw new Error("MultilineText must have multilinedata");let p=null!==(a=o.multilinedata["scale-factor"])&&void 0!==a?a:1,_=!0,f=!0,m="1em";for(let t of o.multilinedata.content){if("\n"==t.text){f=!0,m=null!==(l=t.style.dy)&&void 0!==l?l:"1em";continue}let r=document.createElementNS("http://www.w3.org/2000/svg","tspan"),i=null==t.style.dy,a=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},P),d),{dy:"0",dx:"0"}),{"font-size":g}),t.style);if(f){r.setAttribute("x","0");let t=null!==(s=d.dy)&&void 0!==s?s:"0";i&&(a.dy=_?t:m),f=!1}let o="auto"==a["font-scale"]?n:parseFloat(a["font-scale"]),c=parseFloat(a["font-size"])*o*p;a.tag&&r.setAttribute("_dg_tag",a.tag),r.style.whiteSpace="pre",r.setAttribute("dx",a.dx),r.setAttribute("dy",a.dy),r.setAttribute("font-style",a["font-style"]),r.setAttribute("font-family",a["font-family"]),r.setAttribute("font-size",c.toString()),r.setAttribute("font-weight",a["font-weight"]),r.style.fill=T(a.fill,C),r.style.stroke=T(a.stroke,C),r.style.opacity=a.opacity;let h=t.text;a.textvar&&(h=I(h)),r.innerHTML=h,e.appendChild(r),_=!1}e.setAttribute("dy",d.dy),e.setAttribute("text-anchor",d["text-anchor"]),e.setAttribute("transform",`translate(${c} ${h}) rotate(${u}) `),null!=r&&e.setAttribute("_dg_tag",r),t.appendChild(e)}}(t,r,null!=i?i:1,s)}}function Z(t,e,n=!0,r=!0,i=!0){J(t,e,{set_html_attribute:n,render_text:r,clear_svg:i})}function J(t,e,n={}){var r,i,a,l,s,o,c;const h=null===(r=n.set_html_attribute)||void 0===r||r,u=null===(i=n.render_text)||void 0===i||i,d=null===(a=n.clear_svg)||void 0===a||a,g=null!==(l=n.embed_image)&&void 0!==l&&l;let p,_;for(let e in t.children){let n=t.children[e];if(n instanceof SVGSVGElement&&"diagram_svg"==n.getAttribute("meta")){p=n;break}}if(null==p&&(p=document.createElementNS("http://www.w3.org/2000/svg","svg"),p.setAttribute("meta","diagram_svg"),p.setAttribute("width","100%"),p.setAttribute("height","100%"),t.appendChild(p)),n.text_scaling_reference_svg&&(n.text_scaling_reference_padding=null!==(o=null!==(s=n.text_scaling_reference_padding)&&void 0!==s?s:n.padding)&&void 0!==o?o:10,n.text_scaling_reference_padding=N(n.text_scaling_reference_padding),_=W(n.text_scaling_reference_svg,n.text_scaling_reference_padding)),d&&(p.innerHTML=""),Y(p,e,u,g,_),h){const e=N(null!==(c=n.padding)&&void 0!==c?c:10);let r=p.getBBox(),i=p.width.baseVal.value-e[1]-e[3],a=p.height.baseVal.value-e[0]-e[2],l=Math.max(r.width/i,r.height/a),s=e.map((t=>t*l));r.x-=s[3],r.y-=s[0],r.width+=s[1]+s[3],r.height+=s[0]+s[2],p.setAttribute("viewBox",`${r.x} ${r.y} ${r.width} ${r.height}`),p.setAttribute("preserveAspectRatio","xMidYMid meet"),t.style.overflow="visible"}if(n.background_color){let t=p.getBBox();0!==p.viewBox.baseVal.width&&(t=p.viewBox.baseVal);let e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("x",t.x.toString()),e.setAttribute("y",t.y.toString()),e.setAttribute("width",t.width.toString()),e.setAttribute("height",t.height.toString()),e.style.fill=T(n.background_color,C),e.style.stroke="none",p.insertBefore(e,p.firstChild)}}function Q(t){return t.startsWith("$")&&t.endsWith("$")}function tt(t){return t.startsWith("$$")&&t.endsWith("$$")}function et(t,e){for(let r=0;r<t.children.length;r++){let i=t.children[r];if(i instanceof SVGTextElement){let a=i.innerHTML;if(!Q(a))continue;let l=i.getAttribute("font-size");if(null==l)continue;let s=parseFloat(l),o=e(tt(n=a)?n.substring(2,n.length-2):Q(n)?n.substring(1,n.length-1):n,{display:tt(a)}),c=i.getAttribute("_x"),h=i.getAttribute("_y");if(null==c||null==h)continue;let u=i.getAttribute("text-anchor"),d=i.getAttribute("dy");if(null==u||null==d)continue;i.outerHTML=o,i=t.children[r];let g=i.getAttribute("width");if(null==g)continue;let p=parseFloat(g.substring(0,g.length-2)),_=i.getAttribute("height");if(null==_)continue;const f=2;let m=p*s/f,b=parseFloat(_.substring(0,_.length-2))*s/f,v=parseFloat(c),y=parseFloat(h);switch(u){case"start":break;case"middle":v-=m/2;break;case"end":v-=m}switch(d){case"0.75em":break;case"0.25em":y-=b/2;break;case"-0.25em":y-=b}i.setAttribute("width",m.toString()),i.setAttribute("height",b.toString()),i.setAttribute("x",v.toString()),i.setAttribute("y",y.toString())}else i instanceof SVGElement&&et(i,e)}var n}function nt(t){let e=t.querySelector("svg[meta=diagram_svg]");if(null==e)return void console.warn("Cannot find svg element");let n=t.querySelector("svg[meta=control_svg]"),r=e;if(null!=n){let t=e.cloneNode(!0);for(let e in n.children){let r=n.children[e];r instanceof SVGSVGElement&&t.appendChild(r.cloneNode(!0))}r=t}let i=(new XMLSerializer).serializeToString(r),a=new Blob([i],{type:"image/svg+xml"}),l=URL.createObjectURL(a),s=document.createElement("a");s.href=l,s.download="diagramatics.svg",s.click()}function rt(t){if(null==t.querySelector("svg[meta=diagram_svg]"))return void console.warn("Cannot find svg element");let e=t,n=(new XMLSerializer).serializeToString(e),r=new Blob([n],{type:"image/svg+xml"});const i=window.URL||window.webkitURL||window,a=i.createObjectURL(r),l=new Image;l.width=e.width.baseVal.value,l.height=e.height.baseVal.value,l.src=a,l.onload=function(){const t=document.createElement("canvas");t.width=l.width,t.height=l.height;const e=t.getContext("2d");null==e||e.drawImage(l,0,0),i.revokeObjectURL(a);const n=t.toDataURL("image/png").replace("image/png","image/octet-stream"),r=document.createElement("a");r.href=n,r.download="diagramatics.png",r.click()}}function it(t,n){return _([e(-t/2,-n/2),e(t/2,-n/2),e(t/2,n/2),e(-t/2,n/2)])}function at(t,n){return _([t,e(n.x,t.y),n,e(t.x,n.y)])}function lt(t=1){return it(t,t)}function st(t,n=1){let r=[];for(let i=0;i<t;i++)r.push(e(0,n).rotate(2*i*Math.PI/t));return _(r)}function ot(t,e=1){return st(t,e/(2*Math.sin(Math.PI/t)))}function ct(t=1){return st(50,t).append_tags(a.CIRCLE)}function ht(t=1,n=x(360)){let r=[];for(let i=0;i<100;i++)r.push(e(t,0).rotate(i*n/99));return g(r)}function ut(t,n=1){return d(p(e(0,0),t).append_tags(a.ARROW_LINE),_([e(0,0),e(-n,n/2),e(-n,-n/2)]).rotate(t.angle()).position(t).append_tags(a.ARROW_HEAD))}function dt(t,e,n=1){return ut(e.sub(t),n).position(t)}function gt(t,n,r=1){let i=p(t,n).append_tags(a.ARROW_LINE),l=n.sub(t),s=_([e(0,0),e(-r,r/2),e(-r,-r/2)]);return d(i,s.rotate(l.angle()).position(n).append_tags(a.ARROW_HEAD),s.rotate(l.angle()+Math.PI).position(t).append_tags(a.ARROW_HEAD))}function pt(t){return m(t).append_tags(a.TEXTVAR)}function _t(t){if(!t.tags.includes(a.CIRCLE))return-1;let e=t.get_anchor("center-center");if(null==t.path)return-1;let n=t.path.points[0];return e.sub(n).length()}function ft(t){return t.tags.includes(a.LINE)?null==t.path?[e(0,0),e(0,0)]:[t.path.points[0],t.path.points[1]]:[e(0,0),e(0,0)]}function mt(t){let e=t.bounding_box();return[e[1].x-e[0].x,e[1].y-e[0].y]}var bt=Object.freeze({__proto__:null,circle_radius:_t,circle_tangent_point_from_point:function(t,n){let r=_t(n);if(-1==r)return[e(0,0),e(0,0)];let i=n.get_anchor("center-center"),a=r,l=i.sub(t).length_sq(),s=a*a,o=t.sub(i),c=s/l,h=o.scale(c),u=a*Math.sqrt(l-s)/l,d=e(-o.y,o.x).scale(u);return[h.add(d).add(i),h.sub(d).add(i)]},line_extend:function(t,e,n){if(!t.tags.includes(a.LINE))return t;if(null==t.path)return t;let r=t.path.points[0],i=t.path.points[1],l=i.sub(r).normalize(),s=r.sub(l.scale(e)),o=i.add(l.scale(n)),c=t.copy();return null==c.path?t:(c.path.points=[s,o],c)},line_intersection:function(t,n){if(!t.tags.includes(a.LINE)||!n.tags.includes(a.LINE))return e(1/0,1/0);let[r,i]=ft(t),[l,s]=ft(n),o=r.x,c=r.y,h=i.x,u=i.y,d=l.x,g=l.y,p=s.x,_=s.y,f=(o-h)*(g-_)-(c-u)*(d-p);return 0==f?e(1/0,1/0):e(((o*u-c*h)*(d-p)-(o-h)*(d*_-g*p))/f,((o*u-c*h)*(g-_)-(c-u)*(d*_-g*p))/f)},line_intersection_x:function(t,n){let[r,i]=ft(t);return e(n,r.y+(i.y-r.y)*(n-r.x)/(i.x-r.x))},line_intersection_y:function(t,n){let[r,i]=ft(t);return e(r.x+(i.x-r.x)*(n-r.y)/(i.y-r.y),n)},line_points:ft,size:mt});function vt(t,n="center"){if(0==t.length)return f();let r=[...t];if("top"==n){let t=r[0].get_anchor("top-left").y;for(let n=0;n<r.length;n++)r[n]=r[n].translate(e(0,t-r[n].get_anchor("top-left").y));return d(...r)}if("center"==n){let t=r[0].get_anchor("center-left").y;for(let n=0;n<r.length;n++)r[n]=r[n].translate(e(0,t-r[n].get_anchor("center-left").y));return d(...r)}if("bottom"==n){let t=r[0].get_anchor("bottom-left").y;for(let n=0;n<r.length;n++)r[n]=r[n].translate(e(0,t-r[n].get_anchor("bottom-left").y));return d(...r)}throw new Error("Unknown vertical alignment : "+n)}function yt(t,n="center"){if(0==t.length)return f();let r=[...t];if("left"==n){let t=r[0].get_anchor("top-left").x;for(let n=0;n<r.length;n++)r[n]=r[n].translate(e(t-r[n].get_anchor("top-left").x,0));return d(...r)}if("center"==n){let t=r[0].get_anchor("top-center").x;for(let n=0;n<r.length;n++)r[n]=r[n].translate(e(t-r[n].get_anchor("top-center").x,0));return d(...r)}if("right"==n){let t=r[0].get_anchor("top-right").x;for(let n=0;n<r.length;n++)r[n]=r[n].translate(e(t-r[n].get_anchor("top-right").x,0));return d(...r)}throw new Error("Unknown horizontal alignment : "+n)}function xt(t,n=0){if(0==t.length)return f();let r=[...t],i=[r[0]];for(let t=1;t<r.length;t++){let a=i[t-1],l=r[t],s=a.get_anchor("top-right").x-l.get_anchor("top-left").x+n;i.push(l.translate(e(s,0)))}return d(...i)}function wt(t,n=0){if(0==t.length)return f();let r=[...t],i=[r[0]];for(let t=1;t<r.length;t++){let a=i[t-1],l=r[t],s=a.get_anchor("bottom-left").y-l.get_anchor("top-left").y-n;i.push(l.translate(e(0,s)))}return d(...i)}function kt(t,e=0,n="center"){return xt(vt(t,n).children,e)}function At(t,e=0,n="center"){return wt(yt(t,n).children,e)}function Et(t,e,n=0,r=0){if(0==t.length)return f();let i=[...t],a=Math.ceil(i.length/e),l=[];for(let t=0;t<a;t++)l.push(i.slice(t*e,(t+1)*e));let s=wt(l.map((t=>xt(t,r))),n),o=[];for(let t=0;t<s.children.length;t++)for(let e=0;e<s.children[t].children.length;e++)o.push(s.children[t].children[e]);return d(...o)}function Ot(t,e,n=0,r=0,i="center",a="left"){if(0==t.length)return f();let l=[],s=[],o=0;function c(t){let e=kt(t,r,i);l.push(e),s=[],o=0}for(let n=0;n<t.length;n++){let i=t[n],a=mt(i)[0];a>e?(s.length>0&&c(s),s.push(i),c(s)):(o+r+a>e&&c(s),s.push(i),o+=a+r)}s.length>0&&c(s);let h=At(l,n,a),u=[];for(let t=0;t<h.children.length;t++)for(let e=0;e<h.children[t].children.length;e++)u.push(h.children[t].children[e]);return d(...u)}const Lt=(t,e,n)=>{let r="number"==typeof e&&null!=n?function(t,e){return t.toFixed(e).replace(/\.?0+$/,"")}(e,n):e.toString();return`${I(t)} = ${r}`};var St,Nt;!function(t){t.locator="control_svg",t.dnd="dnd_svg",t.custom="custom_int_svg",t.button="button_svg"}(St||(St={}));class Mt{constructor(t,e,n){this.control_container_div=t,this.diagram_outer_svg=e,this.inp_variables={},this.inp_setter={},this.display_mode="svg",this.diagram_svg=void 0,this.locator_svg=void 0,this.dnd_svg=void 0,this.custom_svg=void 0,this.button_svg=void 0,this.locatorHandler=void 0,this.dragAndDropHandler=void 0,this.buttonHandler=void 0,this.draw_function=t=>{},this.display_precision=5,this.intervals={},this.registeredEventListenerRemoveFunctions=[],null!=n&&(this.inp_variables=n)}draw(){var t,e;this.draw_function(this.inp_variables,this.inp_setter),null===(t=this.locatorHandler)||void 0===t||t.setViewBox(),null===(e=this.dragAndDropHandler)||void 0===e||e.setViewBox(),Ct(this.custom_svg,this.diagram_svg),Ct(this.button_svg,this.diagram_svg)}set(t,e){this.inp_setter[t](e)}get(t){return this.inp_variables[t]}label(t,e,n=Lt){let r=document.createElement("div");r.classList.add("diagramatics-label"),r.innerHTML=n(t,e,this.display_precision),this.inp_variables[t]=e;this.inp_setter[t]=e=>{this.inp_variables[t]=e,r.innerHTML=n(t,e,this.display_precision)};let i=document.createElement("div");i.classList.add("diagramatics-label-container"),i.appendChild(r),this.control_container_div.appendChild(i)}locator_draw(){var t;null===(t=this.locatorHandler)||void 0===t||t.setViewBox()}locator_initial_draw(){var t;null===(t=this.locatorHandler)||void 0===t||t.setViewBox()}drag_and_drop_initial_draw(){this.dnd_initial_draw()}dnd_initial_draw(){var t,e;null===(t=this.dragAndDropHandler)||void 0===t||t.setViewBox(),null===(e=this.dragAndDropHandler)||void 0===e||e.drawSvg()}registerEventListener(t,e,n,r){t.addEventListener(e,n,r);this.registeredEventListenerRemoveFunctions.push((()=>t.removeEventListener(e,n)))}removeRegisteredEventListener(){this.registeredEventListenerRemoveFunctions.forEach((t=>t())),this.registeredEventListenerRemoveFunctions=[]}get_svg_element(t){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");let e;for(let n in this.diagram_outer_svg.children){let r=this.diagram_outer_svg.children[n];r instanceof SVGSVGElement&&r.getAttribute("meta")==t&&(e=r)}return null==e&&(e=document.createElementNS("http://www.w3.org/2000/svg","svg"),e.setAttribute("meta",t),e.setAttribute("width","100%"),e.setAttribute("height","100%"),t==St.dnd&&(e.style.overflow="visible"),this.diagram_outer_svg.appendChild(e)),e}get_diagram_svg(){let t=this.get_svg_element("diagram_svg");return this.diagram_svg=t,t}locator(t,e,n,r="blue",i,a=!0){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");this.inp_variables[t]=e;let s=this.get_diagram_svg(),o=this.get_svg_element(St.locator);if(this.locator_svg=o,null==this.locatorHandler){let t=new Ht(o,s);this.locatorHandler=t,this.registerEventListener(this.diagram_outer_svg,"mousemove",(e=>{t.drag(e)})),this.registerEventListener(this.diagram_outer_svg,"mouseup",(e=>{t.endDrag(e)})),this.registerEventListener(this.diagram_outer_svg,"touchmove",(e=>{t.drag(e)})),this.registerEventListener(this.diagram_outer_svg,"touchend",(e=>{t.endDrag(e)})),this.registerEventListener(this.diagram_outer_svg,"touchcancel",(e=>{t.endDrag(e)}))}const c=(e,n=!0)=>{this.inp_variables[t]=e,n&&this.draw()};this.locatorHandler.registerCallback(t,c);let h,u=Ht.create_locator_circle_pointer_svg(n,e,r,a);if(a){let t=u.getElementsByClassName("diagramatics-locator-blink");for(let e=0;e<t.length;e++)this.locatorHandler.addBlinkingCircleOuter(t[e])}if(this.registerEventListener(u,"mousedown",(e=>{this.locatorHandler.startDrag(e,t,u)})),this.registerEventListener(u,"touchstart",(e=>{this.locatorHandler.startDrag(e,t,u)})),o.appendChild(u),i){if(i.type!=l.Polygon&&i.type!=l.Curve)throw Error("Track diagram must be a polygon or curve");if(null==i.path)throw Error("diagram {diagtam.type} must have a path");let t=i.path.points;h=e=>{let n=Tt(e,t);return u.setAttributeNS(null,"x",n.x.toString()),u.setAttributeNS(null,"y",(-n.y).toString()),n}}else h=t=>(u.setAttributeNS(null,"x",t.x.toString()),u.setAttributeNS(null,"y",(-t.y).toString()),t);this.locatorHandler.registerSetter(t,h),c(h(e),!1)}locator_custom(t,e,n,r,i=!0){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");this.inp_variables[t]=e;let a=this.get_diagram_svg(),s=this.get_svg_element(St.locator);if(this.locator_svg=s,null==this.locatorHandler){let t=new Ht(s,a);this.locatorHandler=t,this.registerEventListener(this.diagram_outer_svg,"mousemove",(e=>{t.drag(e)})),this.registerEventListener(this.diagram_outer_svg,"mouseup",(e=>{t.endDrag(e)})),this.registerEventListener(this.diagram_outer_svg,"touchmove",(e=>{t.drag(e)})),this.registerEventListener(this.diagram_outer_svg,"touchend",(e=>{t.endDrag(e)})),this.registerEventListener(this.diagram_outer_svg,"touchcancel",(e=>{t.endDrag(e)}))}const o=(e,n=!0)=>{this.inp_variables[t]=e,n&&this.draw()};this.locatorHandler.registerCallback(t,o);let c,h=this.locatorHandler.create_locator_diagram_svg(n,i);if(this.registerEventListener(h,"mousedown",(e=>{this.locatorHandler.startDrag(e,t,h)})),this.registerEventListener(h,"touchstart",(e=>{this.locatorHandler.startDrag(e,t,h)})),s.appendChild(h),r){if(r.type!=l.Polygon&&r.type!=l.Curve)throw Error("Track diagram must be a polygon or curve");if(null==r.path)throw Error("diagram {diagtam.type} must have a path");let t=r.path.points;c=e=>{let n=Tt(e,t);return h.setAttributeNS(null,"x",n.x.toString()),h.setAttributeNS(null,"y",(-n.y).toString()),n}}else c=t=>(h.setAttributeNS(null,"x",t.x.toString()),h.setAttributeNS(null,"y",(-t.y).toString()),t);this.locatorHandler.registerSetter(t,c),o(c(e),!1)}slider(t,e=0,n=100,r=50,i=-1,a=1.5,l=Lt){-1==i&&(i=(n-e)/100),this.inp_variables[t]=r;let s=document.createElement("div");s.classList.add("diagramatics-label"),s.innerHTML=l(t,r,this.display_precision);const o=(e,n=!0)=>{this.inp_variables[t]=e,s.innerHTML=l(t,e,this.display_precision),n&&this.draw()};let c=function(t,e=0,n=100,r=50,i){let a=document.createElement("input");return a.type="range",a.min=e.toString(),a.max=n.toString(),a.value=r.toString(),a.step=i.toString(),a.oninput=()=>{let e=a.value;t(parseFloat(e))},a.classList.add("diagramatics-slider"),a}(o,e,n,r,i);this.inp_setter[t]=t=>{c.value=t.toString(),o(t,!1)};const h=1e3*a/((n-e)/i);let u=document.createElement("button"),d=document.createElement("div");d.classList.add("diagramatics-slider-playbutton-symbol"),u.appendChild(d),u.classList.add("diagramatics-slider-playbutton"),u.onclick=()=>{null==this.intervals[t]?(u.classList.add("paused"),this.intervals[t]=setInterval((()=>{let t=parseFloat(c.value);t+=i,t=(t-e)%(n-e)+e,c.value=t.toString(),o(t)}),h)):(u.classList.remove("paused"),clearInterval(this.intervals[t]),this.intervals[t]=void 0)};let g=document.createElement("div");g.classList.add("diagramatics-slider-leftcontainer"),g.appendChild(document.createElement("br")),g.appendChild(u);let p=document.createElement("div");p.classList.add("diagramatics-slider-rightcontainer"),p.appendChild(s),p.appendChild(c);let _=document.createElement("div");_.classList.add("diagramatics-slider-container"),_.appendChild(g),_.appendChild(p),this.control_container_div.appendChild(_)}init_drag_and_drop(){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");let t=this.get_diagram_svg(),e=this.get_svg_element(St.dnd);if(this.dnd_svg=e,null==this.dragAndDropHandler){let n=new It(e,t);this.dragAndDropHandler=n,this.registerEventListener(document,"mousemove",(t=>{n.drag(t)})),this.registerEventListener(document,"mouseup",(t=>{n.endDrag(t)})),this.registerEventListener(document,"touchmove",(t=>{n.drag(t)})),this.registerEventListener(document,"touchend",(t=>{n.endDrag(t)})),this.registerEventListener(document,"touchcancel",(t=>{n.endDrag(t)}))}}dnd_container(t,e,n,r){var i;this.init_drag_and_drop(),null===(i=this.dragAndDropHandler)||void 0===i||i.add_container(t,e,n,r)}dnd_draggable_to_container(t,e,n,r){if(this.init_drag_and_drop(),null==this.dragAndDropHandler)throw Error("dragAndDropHandler in Interactive class is undefined");this.inp_variables[t]=e.origin,this.dragAndDropHandler.add_draggable_to_container(t,e,n);this.dragAndDropHandler.registerCallback(t,((e,i=!0)=>{this.inp_variables[t]=e,r&&r(t,n),i&&this.draw()}))}dnd_draggable(t,e,n,r){if(this.init_drag_and_drop(),null==this.dragAndDropHandler)throw Error("dragAndDropHandler in Interactive class is undefined");this.inp_variables[t]=e.origin,this.dragAndDropHandler.add_draggable_with_container(t,e,n);this.dragAndDropHandler.registerCallback(t,((e,n=!0)=>{this.inp_variables[t]=e,r&&r(t,e),n&&this.draw()}))}dnd_register_drop_outside_callback(t){var e;null===(e=this.dragAndDropHandler)||void 0===e||e.register_dropped_outside_callback(t)}dnd_move_to_container(t,e){var n;null===(n=this.dragAndDropHandler)||void 0===n||n.try_move_draggable_to_container(t,e)}get_dnd_data(){var t,e;return null!==(e=null===(t=this.dragAndDropHandler)||void 0===t?void 0:t.getData())&&void 0!==e?e:[]}set_dnd_data(t){var e;null===(e=this.dragAndDropHandler)||void 0===e||e.setData(t)}get_dnd_container_content_size(t){return this.dragAndDropHandler?this.dragAndDropHandler.get_container_content_size(t):[NaN,NaN]}set_dnd_content_sort(t){this.dragAndDropHandler&&(this.dragAndDropHandler.sort_content=t)}remove_dnd_draggable(t){var e;null===(e=this.dragAndDropHandler)||void 0===e||e.remove_draggable(t)}custom_object(t,e,n){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");let r=this.get_diagram_svg(),i=this.get_svg_element(St.custom),a=document.createElementNS("http://www.w3.org/2000/svg","svg");return Y(a,n,!0,!1,W(r)),a.setAttribute("overflow","visible"),a.setAttribute("class",e.join(" ")),a.setAttribute("id",t),i.appendChild(a),this.custom_svg=i,a}init_button(){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");let t=this.get_diagram_svg(),e=this.get_svg_element(St.button);if(this.button_svg=e,null==this.buttonHandler){let n=new Rt(e,t);this.buttonHandler=n}}button_toggle(t,e,n,r=!1,i){if(this.init_button(),null==this.buttonHandler)throw Error("buttonHandler in Interactive class is undefined");let a;this.inp_variables[t]=r,a=i?(e,n=!0)=>{this.inp_variables[t]=e,i(t,e),n&&this.draw()}:(e,n=!0)=>{this.inp_variables[t]=e,n&&this.draw()};let l=this.buttonHandler.try_add_toggle(t,e,n,r,a);this.inp_setter[t]=l}button_click(t,e,n,r){if(this.init_button(),null==this.buttonHandler)throw Error("buttonHandler in Interactive class is undefined");this.buttonHandler.try_add_click(t,e,n,(()=>{r(),this.draw()}))}}function Ct(t,e){null!=t&&null!=e&&(t.setAttribute("viewBox",e.getAttribute("viewBox")),t.setAttribute("preserveAspectRatio",e.getAttribute("preserveAspectRatio")))}function Tt(t,e){if(0==e.length)return t;let n=1/0,r=e[0];for(let i=0;i<e.length;i++){let a=e[i].sub(t).length_sq();a<n&&(n=a,r=e[i])}return r}function zt(t,e){let n;return n=navigator.userAgent.toLowerCase().indexOf("firefox")>-1?function(t){let e=t.getScreenCTM(),n=t.width.baseVal.value,r=t.height.baseVal.value,i=t.viewBox.baseVal,a=n/i.width,l=r/i.height,s=Math.min(a,l),o=n/2-(i.width/2+i.x)*s,c=r/2-(i.height/2+i.y)*s;return DOMMatrix.fromMatrix(e).translate(o,c).scale(s)}(e):e.getScreenCTM(),{x:(t.x-n.e)/n.a,y:-(t.y-n.f)/n.d}}function jt(t,e){return window.TouchEvent&&t instanceof TouchEvent&&(t=t.touches[0]),zt({x:t.clientX,y:t.clientY},e)}function Dt(t,e){return jt(t,e)}class Ht{constructor(t,e){this.control_svg=t,this.diagram_svg=e,this.selectedElement=null,this.selectedVariable=null,this.callbacks={},this.setter={},this.blinking_circle_outers=[],this.first_touch_callback=null}startDrag(t,e,n){this.selectedElement=n,this.selectedVariable=e,this.handleBlinking()}drag(t){if(null==this.selectedElement)return;if(null==this.selectedVariable)return;t instanceof MouseEvent&&t.preventDefault(),window.TouchEvent&&t instanceof TouchEvent&&t.preventDefault();let n=jt(t,this.control_svg),r=e(n.x,n.y);null!=this.setter[this.selectedVariable]&&(r=this.setter[this.selectedVariable](r)),null!=this.selectedVariable&&(null!=this.callbacks[this.selectedVariable]&&this.callbacks[this.selectedVariable](r),this.setViewBox())}setViewBox(){this.control_svg.setAttribute("viewBox",this.diagram_svg.getAttribute("viewBox")),this.control_svg.setAttribute("preserveAspectRatio",this.diagram_svg.getAttribute("preserveAspectRatio"))}endDrag(t){this.selectedElement=null,this.selectedVariable=null}registerCallback(t,e){this.callbacks[t]=e}registerSetter(t,e){this.setter[t]=e}addBlinkingCircleOuter(t){this.blinking_circle_outers.push(t)}handleBlinking(){if(0!=this.blinking_circle_outers.length){for(let t=0;t<this.blinking_circle_outers.length;t++)this.blinking_circle_outers[t].classList.remove("diagramatics-locator-blink");this.blinking_circle_outers=[],null!=this.first_touch_callback&&this.first_touch_callback()}}create_locator_diagram_svg(t,n){let r=document.createElementNS("http://www.w3.org/2000/svg","svg");return Y(r,t.position(e(0,0)),!0,!1,W(this.diagram_svg)),r.style.cursor="pointer",r.setAttribute("overflow","visible"),n&&(r.classList.add("diagramatics-locator-blink"),this.addBlinkingCircleOuter(r)),r}static create_locator_circle_pointer_svg(t,e,n,r){let i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("overflow","visible"),i.style.cursor="pointer";let a=document.createElementNS("http://www.w3.org/2000/svg","circle"),l=document.createElementNS("http://www.w3.org/2000/svg","circle"),s=.4*t;return a.setAttribute("r",t.toString()),a.setAttribute("fill",T(n,C)),a.setAttribute("fill-opacity","0.3137"),a.setAttribute("stroke","none"),a.classList.add("diagramatics-locator-outer"),r&&a.classList.add("diagramatics-locator-blink"),l.setAttribute("r",s.toString()),l.setAttribute("fill",T(n,C)),l.setAttribute("stroke","none"),l.classList.add("diagramatics-locator-inner"),i.appendChild(a),i.appendChild(l),i.setAttribute("x",e.x.toString()),i.setAttribute("y",(-e.y).toString()),i}}!function(t){t.container="diagramatics-dnd-container",t.draggable="diagramatics-dnd-draggable",t.ghost="diagramatics-dnd-draggable-ghost"}(Nt||(Nt={}));class It{constructor(t,e){this.dnd_svg=t,this.diagram_svg=e,this.containers={},this.draggables={},this.callbacks={},this.hoveredContainerName=null,this.draggedElementName=null,this.draggedElementGhost=null,this.dropped_outside_callback=null,this.sort_content=!1,this.dom_to_id_map=new WeakMap}add_container(t,e,n,r){null==this.containers[t]?this.containers[t]={name:t,diagram:e,position:e.origin,content:[],config:null!=r?r:{type:"horizontal-uniform"},capacity:null!=n?n:1}:this.replace_container_svg(t,e,n,r)}generate_position_map(t,n,r,i){var a;let l=t.bounding_box(),s=t.origin;switch(n.type){case"horizontal-uniform":{let t=(l[1].x-l[0].x)/r,n=l[0].x+t/2,i=s.y;return O(0,r).map((r=>e(n+t*r,i)))}case"vertical-uniform":{let t=(l[1].y-l[0].y)/r,n=s.x,i=l[1].y-t/2;return O(0,r).map((r=>e(n,i-t*r)))}case"grid":{let[t,i]=n.value,a=l[1].y-l[0].y,s=(l[1].x-l[0].x)/t,o=a/i,c=l[0].x+s/2,h=l[1].y-o/2;return O(0,r).map((n=>e(c+s*(n%t),h-o*Math.floor(n/t))))}case"vertical":{const r=i.map((t=>{var e,n;return null!==(n=null===(e=this.draggables[t])||void 0===e?void 0:e.diagram_size)&&void 0!==n?n:[0,0]}));return At(r.map((([t,e])=>it(t,e).mut())),n.padding).mut().move_origin("top-center").position(t.get_anchor("top-center")).translate(e(0,-n.padding)).children.map((t=>t.origin))}case"horizontal":{const r=i.map((t=>{var e,n;return null!==(n=null===(e=this.draggables[t])||void 0===e?void 0:e.diagram_size)&&void 0!==n?n:[0,0]}));return kt(r.map((([t,e])=>it(t,e).mut())),n.padding).mut().move_origin("center-left").position(t.get_anchor("center-left")).translate(e(n.padding,0)).children.map((t=>t.origin))}case"flex-row":{const t=null!==(a=n.padding)&&void 0!==a?a:0,r=l[1].x-l[0].x-2*t,o=i.map((t=>{var e,n;return null!==(n=null===(e=this.draggables[t])||void 0===e?void 0:e.diagram_size)&&void 0!==n?n:[0,0]}));let c=Ot(o.map((([t,e])=>it(t,e).mut())),r,t,t,n.vertical_alignment,n.horizontal_alignment).mut();switch(n.horizontal_alignment){case"center":c=c.move_origin("top-center").position(e(s.x,l[1].y-t));break;case"right":c=c.move_origin("top-right").position(e(l[1].x-t,l[1].y-t));break;default:c=c.move_origin("top-left").position(e(l[0].x+t,l[1].y-t))}return c.children.map((t=>t.origin))}default:return[]}}get_container_content_size(t){var e;const n=this.containers[t];if(null==n)return[NaN,NaN];const r=null!==(e=n.config.padding)&&void 0!==e?e:0,i=n.content.map((t=>{var e,n;return null!==(n=null===(e=this.draggables[t])||void 0===e?void 0:e.diagram)&&void 0!==n?n:f()})),[a,l]=mt(d(...i));return[a+2*r,l+2*r]}replace_draggable_svg(t,e){var n;let r=this.draggables[t];null!=r&&(null===(n=r.svgelement)||void 0===n||n.remove(),r.diagram=e,r.diagram_size=mt(e),this.add_draggable_svg(t,e),this.reposition_container_content(r.container))}replace_container_svg(t,e,n,r){var i;let a=this.containers[t];null!=a&&(null===(i=a.svgelement)||void 0===i||i.remove(),a.diagram=e,n&&(a.capacity=n),r&&(a.config=r),this.add_container_svg(t,e),this.reposition_container_content(t))}add_draggable_to_container(t,e,n){if(null!=this.draggables[t])return this.replace_draggable_svg(t,e),void this.move_draggable_to_container(t,n);const r=mt(e);this.draggables[t]={name:t,diagram:e.mut(),diagram_size:r,position:e.origin,container:n},this.containers[n].content.push(t)}add_draggable_with_container(t,e,n){if(null!=this.draggables[t])return void this.replace_draggable_svg(t,e);let r=`_container0_${t}`;null==n&&(n=this.diagram_container_from_draggable(e)),this.add_container(r,n);const i=mt(e);this.containers[r].content.push(t),this.draggables[t]={name:t,diagram:e.mut(),diagram_size:i,position:e.origin,container:r}}remove_draggable(t){var e;for(let e in this.containers){const n=this.containers[e];n.content=n.content.filter((e=>e!=t))}null===(e=this.draggables[t].svgelement)||void 0===e||e.remove(),delete this.draggables[t]}registerCallback(t,e){this.callbacks[t]=e}register_dropped_outside_callback(t){this.dropped_outside_callback=t}setViewBox(){this.dnd_svg.setAttribute("viewBox",this.diagram_svg.getAttribute("viewBox")),this.dnd_svg.setAttribute("preserveAspectRatio",this.diagram_svg.getAttribute("preserveAspectRatio"))}drawSvg(){for(let t in this.containers)this.containers[t].svgelement||this.add_container_svg(t,this.containers[t].diagram);for(let t in this.draggables)this.draggables[t].svgelement||this.add_draggable_svg(t,this.draggables[t].diagram);for(let t in this.containers)this.reposition_container_content(t)}getData(){let t=[];for(let e in this.containers)t.push({container:e,content:this.containers[e].content});return t}setData(t){try{for(let e of t)for(let t of e.content)this.try_move_draggable_to_container(t,e.container)}catch(t){console.error("the data is not valid")}}diagram_container_from_draggable(t){return at(...t.bounding_box()).move_origin(t.origin).strokedasharray([5])}add_container_svg(t,n){let r=document.createElementNS("http://www.w3.org/2000/svg","svg");Y(r,n.position(e(0,0)),!1,!1,W(this.diagram_svg),Nt.container);let i=n.origin;r.setAttribute("overflow","visible"),r.setAttribute("x",i.x.toString()),r.setAttribute("y",(-i.y).toString()),r.setAttribute("class",Nt.container),this.dnd_svg.prepend(r),this.containers[t].svgelement=r,this.dom_to_id_map.set(r,t)}add_draggable_svg(t,n){let r=document.createElementNS("http://www.w3.org/2000/svg","svg");Y(r,n.position(e(0,0)),!0,!1,W(this.diagram_svg),Nt.draggable);let i=n.origin;r.setAttribute("overflow","visible"),r.setAttribute("x",i.x.toString()),r.setAttribute("y",(-i.y).toString()),r.setAttribute("class",Nt.draggable),r.setAttribute("draggable","true"),r.onmousedown=e=>{this.draggedElementName=t,this.startDrag(e)},r.ontouchstart=e=>{this.draggedElementName=t,this.startDrag(e)},this.dnd_svg.append(r),this.draggables[t].svgelement=r,this.dom_to_id_map.set(r,t)}reposition_container_content(t){var e,n,r;let i=this.containers[t];if(null==i)return;this.sort_content&&i.content.sort();const a=this.generate_position_map(i.diagram,i.config,i.capacity,i.content);for(let t=0;t<i.content.length;t++){let l=this.draggables[i.content[t]],s=null!==(e=a[t])&&void 0!==e?e:i.diagram.origin;l.diagram=l.diagram.position(s),l.position=s,null===(n=l.svgelement)||void 0===n||n.setAttribute("x",s.x.toString()),null===(r=l.svgelement)||void 0===r||r.setAttribute("y",(-s.y).toString())}}remove_draggable_from_container(t,e){this.containers[e].content=this.containers[e].content.filter((e=>e!=t))}move_draggable_to_container(t,e){let n=this.draggables[t];if(n.container==e)return;let r=this.containers[e],i=n.container;this.remove_draggable_from_container(t,i),n.container=e,r.content.push(t),this.reposition_container_content(e),this.reposition_container_content(i);let a=this.draggables[t];this.callbacks[a.name](a.position)}try_move_draggable_to_container(t,e){let n=this.draggables[t],r=this.containers[e];if(r.content.length+1<=r.capacity)this.move_draggable_to_container(t,e);else if(1==r.capacity){let i=n.container,a=r.content[0];this.move_draggable_to_container(a,i),this.move_draggable_to_container(t,e)}}startDrag(t){t instanceof MouseEvent&&t.preventDefault(),window.TouchEvent&&t instanceof TouchEvent&&t.preventDefault(),this.hoveredContainerName=null,this.reset_hovered_class();let e=this.dnd_svg.getElementsByClassName(Nt.ghost);for(let t=0;t<e.length;t++)e[t].remove();if(null==this.draggedElementName)return;let n=this.draggables[this.draggedElementName];null!=n.svgelement&&(n.svgelement.classList.add("picked"),this.draggedElementGhost=n.svgelement.cloneNode(!0),this.draggedElementGhost.style.pointerEvents="none",this.draggedElementGhost.setAttribute("opacity","0.5"),this.draggedElementGhost.setAttribute("class",Nt.ghost),this.dnd_svg.append(this.draggedElementGhost))}get_dnd_element_data_from_evt(t){let e=null;if(window.TouchEvent&&t instanceof TouchEvent){let n=t.touches[0];e=document.elementFromPoint(n.clientX,n.clientY)}else{const n=t;e=document.elementFromPoint(n.clientX,n.clientY)}if(null==e)return null;if("tspan"==e.localName&&(e=e.parentElement),null==e)return null;let n=e.getAttribute("_dg_tag");if(null==n)return null;if(n==Nt.container){let t=e.parentElement;if(null==t)return null;let n=this.dom_to_id_map.get(t);return null==n?null:{name:n,type:Nt.container}}if(n==Nt.draggable){let t=e.parentElement;if(null==t)return null;let n=this.dom_to_id_map.get(t);return null==n?null:{name:n,type:Nt.draggable}}return null}drag(t){var e,n,r;if(null==this.draggedElementName)return;if(null==this.draggedElementGhost)return;t instanceof MouseEvent&&t.preventDefault(),window.TouchEvent&&t instanceof TouchEvent&&t.preventDefault(),this.reset_hovered_class();let i=this.get_dnd_element_data_from_evt(t);null==i?this.hoveredContainerName=null:i.type==Nt.container?(this.hoveredContainerName=i.name,null===(e=this.containers[i.name].svgelement)||void 0===e||e.classList.add("hovered")):i.type==Nt.draggable&&(this.hoveredContainerName=null===(n=this.draggables[i.name])||void 0===n?void 0:n.container,null===(r=this.draggables[i.name].svgelement)||void 0===r||r.classList.add("hovered"));let a=jt(t,this.dnd_svg);this.draggedElementGhost.setAttribute("x",a.x.toString()),this.draggedElementGhost.setAttribute("y",(-a.y).toString())}endDrag(t){null!=this.hoveredContainerName&&null!=this.draggedElementName&&this.try_move_draggable_to_container(this.draggedElementName,this.hoveredContainerName),null==this.hoveredContainerName&&null!=this.draggedElementName&&null!=this.dropped_outside_callback&&this.dropped_outside_callback(this.draggedElementName),this.draggedElementName=null,this.hoveredContainerName=null,this.reset_hovered_class(),this.reset_picked_class(),null!=this.draggedElementGhost&&(this.draggedElementGhost.remove(),this.draggedElementGhost=null)}reset_hovered_class(){var t,e;for(let e in this.containers)null===(t=this.containers[e].svgelement)||void 0===t||t.classList.remove("hovered");for(let t in this.draggables)null===(e=this.draggables[t].svgelement)||void 0===e||e.classList.remove("hovered")}reset_picked_class(){var t;for(let e in this.draggables)null===(t=this.draggables[e].svgelement)||void 0===t||t.classList.remove("picked")}}class Rt{constructor(t,e){this.button_svg=t,this.diagram_svg=e,this.states={},this.svg_element={},this.touchdownName=null}try_add_toggle(t,e,n,r,i){if(null!=this.svg_element[t]){let[e,n]=this.svg_element[t];e.remove(),n.remove()}return this.add_toggle(t,e,n,r,i)}add_toggle(t,e,n,r,i){let a=document.createElementNS("http://www.w3.org/2000/svg","svg");Y(a,n,!0,!1,W(this.diagram_svg)),a.setAttribute("overflow","visible"),a.style.cursor="pointer";let l=document.createElementNS("http://www.w3.org/2000/svg","svg");Y(l,e,!0,!1,W(this.diagram_svg)),l.setAttribute("overflow","visible"),l.style.cursor="pointer",this.button_svg.appendChild(a),this.button_svg.appendChild(l),this.svg_element[t]=[l,a],this.states[t]=r;const s=t=>{l.setAttribute("display",t?"block":"none"),a.setAttribute("display",t?"none":"block")};s(this.states[t]);const o=(e,n=!0)=>{this.states[t]=e,i(this.states[t],n),s(this.states[t])};l.onclick=t=>{t.preventDefault(),o(!1)},a.onclick=t=>{t.preventDefault(),o(!0)},l.ontouchstart=e=>{e.preventDefault(),this.touchdownName=t},a.ontouchstart=e=>{e.preventDefault(),this.touchdownName=t},l.ontouchend=()=>{this.touchdownName==t&&o(!1),this.touchdownName=null},a.ontouchend=()=>{this.touchdownName==t&&o(!0),this.touchdownName=null};return t=>{o(t,!1)}}try_add_click(t,e,n,r){if(null!=this.svg_element[t]){let[e,n]=this.svg_element[t];e.remove(),n.remove()}this.add_click(t,e,n,r)}add_click(t,e,n,r){let i=document.createElementNS("http://www.w3.org/2000/svg","svg");Y(i,e,!0,!1,W(this.diagram_svg)),i.setAttribute("overflow","visible"),i.style.cursor="pointer";let a=document.createElementNS("http://www.w3.org/2000/svg","svg");Y(a,n,!0,!1,W(this.diagram_svg)),a.setAttribute("overflow","visible"),a.style.cursor="pointer",this.button_svg.appendChild(i),this.button_svg.appendChild(a),this.svg_element[t]=[i,a];const l=t=>{a.setAttribute("display",t?"block":"none"),i.setAttribute("display",t?"none":"block")};l(!1),i.onmousedown=e=>{e.preventDefault(),this.touchdownName=t,l(!0)},i.onmouseup=t=>{t.preventDefault(),this.touchdownName=null},a.onmouseleave=t=>{l(!1)},a.onmousedown=e=>{e.preventDefault(),this.touchdownName=t},a.onmouseup=e=>{this.touchdownName==t&&r(),this.touchdownName=null,l(!1)},i.ontouchstart=e=>{e.preventDefault(),this.touchdownName=t,l(!0)},i.ontouchend=e=>{this.touchdownName==t&&r(),this.touchdownName=null,l(!1)},a.ontouchstart=e=>{e.preventDefault(),this.touchdownName=t,l(!0)},a.ontouchend=e=>{this.touchdownName==t&&r(),this.touchdownName=null,l(!1)}}}function qt(t){return function e(n){if(n.type==l.Polygon||n.type==l.Curve)return t(n);if(n.type==l.Diagram)return n.children=n.children.map((t=>e(t))),n;if(n.type==l.Text||n.type==l.MultilineText)return n;throw new Error("Unreachable, unknown diagram type : "+n.type)}}function Pt(t){return qt((function(e){if(null==e.path)return e;let n=(e.type==l.Curve?A(0,1,t):E(0,1,t)).map((t=>e.parametric_point(t)));return e.path=new u(n),e}))}function Gt(t,e,r){let[i,a,l]=e,s=i.sub(a).normalize(),o=l.sub(a).normalize(),c=Math.abs((s.angle()-o.angle())%Math.PI),h=t/Math.tan(c/2),u=i.sub(a).length(),d=l.sub(a).length();h=Math.min(h,u/2,d/2),t=h*Math.tan(c/2);let g=a.add(s.scale(h)),p=a.add(o.scale(h)),_=Math.sqrt(t*t+h*h),f=a.add(s.add(o).normalize().scale(_)),m=g.sub(f).angle(),b=p.sub(f).angle(),v=b+2*Math.PI,y=b-2*Math.PI,x=Math.abs(m-b);return Math.abs(m-v)<x&&(b=v),Math.abs(m-y)<x&&(b=y),A(m,b,r).map((e=>f.add(n(e).scale(t))))}var Bt=Object.freeze({__proto__:null,add_arrow:function(t,e=!1){return qt((function(n){if(null==n.path)return n;let r=e?n.path.points[0]:n.path.points[n.path.points.length-1];return d(n,dt(e?n.path.points[1]:n.path.points[n.path.points.length-2],r,t)).clone_style_from(n)}))},arrowhead_replace:function(t){return function(e){return e.apply_to_tagged_recursive(a.ARROW_HEAD,(e=>{let n=function(t){var e;if(!t.contain_tag(a.ARROW_HEAD))return NaN;let n=null===(e=t.path)||void 0===e?void 0:e.points;if(null==n)return NaN;if(3!=n.length)return NaN;let r=n[0],i=n[1],l=n[2],s=i.add(l).scale(.5);return r.sub(s).angle()}(e);return t.copy().rotate(n).position(e.origin)}))}},resample:Pt,round_corner:function(t=1,e,n=40){return"number"==typeof t&&(t=[t]),qt((function(r){if(null==r.path)return r;let i=O(0,r.path.points.length);null==e&&(e=i),e=e.filter((t=>i.includes(t))),t=k(t,e.length);let a=[];for(let i=0;i<r.path.points.length;i++){let l=i;if(!e.includes(l)){a.push(r.path.points[i]);continue}let s=(l-1+r.path.points.length)%r.path.points.length,o=(l+1)%r.path.points.length,c=r.path.points[s],h=r.path.points[i],u=r.path.points[o],d=Gt(t[e.indexOf(l)],[c,h,u],n);a=a.concat(d)}return r.path=new u(a),r}))},slicepath:function(t,e,n=100){t>e&&([t,e]=[e,t]),t<0&&(t=0),e>1&&(e=1);let r=Math.floor(n/(e-t));return qt((function(n){if(null==n.path)return n;let i=n.apply(Pt(r));if(null==i.path)return n;let a=i.path.points.slice(Math.floor(t*r),Math.floor(e*r)+1);return i.path=new u(a),i}))},subdivide:function(t=100){return qt((function(n){if(null==n.path)return n;let r=[];for(let i=0;i<n.path.points.length;i++){let a=(i+1)%n.path.points.length,l=n.path.points[i],s=n.path.points[a],o=A(l.x,s.x,t+1),c=A(l.y,s.y,t+1),h=o.map(((t,n)=>e(t,c[n])));h.pop(),r=r.concat(h)}return n.path=new u(r),n}))}});let Vt={bbox:void 0,xrange:[-2,2],yrange:[-2,2],xticks:void 0,yticks:void 0,n_sample:100,ticksize:.1,headsize:.05,tick_label_offset:0};function Ut(t){let n=Object.assign(Object.assign({},Vt),t);if(null==n.bbox){let[t,r]=n.xrange,[i,a]=n.yrange;n.bbox=[e(t,i),e(r,a)]}let[r,i]=n.bbox,[a,l]=n.xrange,[s,o]=n.yrange;return function(t){return e(r.x+(t.x-a)/(l-a)*(i.x-r.x),r.y+(t.y-s)/(o-s)*(i.y-r.y))}}let Xt=Ut;function Ft(t){let n=Object.assign(Object.assign({},Vt),t);if(null==n.bbox){let[t,r]=n.xrange,[i,a]=n.yrange;n.bbox=[e(t,i),e(r,a)]}let[r,i]=n.bbox,l=r.x+(i.x-r.x)/(n.xrange[1]-n.xrange[0])*(0-n.xrange[0]),s=r.y+(i.y-r.y)/(n.yrange[1]-n.yrange[0])*(0-n.yrange[0]);return d(gt(e(r.x,s),e(i.x,s),n.headsize).append_tags(a.GRAPH_AXIS),gt(e(l,r.y),e(l,i.y),n.headsize).append_tags(a.GRAPH_AXIS)).stroke("gray").fill("gray")}function $t(t){let n=Object.assign(Object.assign({},Vt),t);if(null==n.bbox){let[t,r]=n.xrange,[i,a]=n.yrange;n.bbox=[e(t,i),e(r,a)]}let[r,i]=n.bbox;return d(dt(r,e(i.x,r.y),n.headsize).append_tags(a.GRAPH_AXIS),dt(r,e(r.x,i.y),n.headsize).append_tags(a.GRAPH_AXIS)).stroke("gray").fill("gray")}function Wt(t){let n=Object.assign(Object.assign({},Vt),t);if(null==n.bbox){let[t,r]=n.xrange,[i,a]=n.yrange;n.bbox=[e(t,i),e(r,a)]}let[r,i]=n.bbox,l=2*n.ticksize;null==n.xticks&&(n.xticks=te(n.xrange[0],n.xrange[1],!1),n.xticks=n.xticks.filter((t=>t>n.xrange[0]&&t<n.xrange[1])));let s=(n.xticks[1]-n.xticks[0])/2,o=n.xticks[0]-s,c=Ut(n),h=c(e(o-s/2,0)),u=c(e(o+s/2,0)),_=u.x-h.x,f=h.add(e(1*_/3,-l/2)),m=h.add(e(2*_/3,l/2)),b=g([h,f,m,u]),v=d(p(r,h),b,dt(u,e(i.x,r.y),n.headsize)).append_tags(a.GRAPH_AXIS);return d(v,dt(r,e(r.x,i.y),n.headsize).append_tags(a.GRAPH_AXIS)).stroke("gray").fill("gray")}function Kt(t,n,r){let i=Object.assign(Object.assign({},Vt),r),l=i.ticksize,s=Ut(i)(e(t,n));return p(e(s.x,s.y+l/2),e(s.x,s.y-l/2)).stroke("gray").append_tags(a.GRAPH_TICK)}function Yt(t,n,r,i){let l=Kt(t,n,i),s=pt(r).move_origin_text("top-center").translate(l.get_anchor("bottom-center")).translate(e(0,-((null==i?void 0:i.tick_label_offset)||0))).textfill("gray").append_tags(a.GRAPH_TICK_LABEL);return d(l,s)}function Zt(t,n,r){let i=Object.assign(Object.assign({},Vt),r),l=i.ticksize,s=Ut(i)(e(n,t));return p(e(s.x+l/2,s.y),e(s.x-l/2,s.y)).stroke("gray").append_tags(a.GRAPH_TICK)}function Jt(t,n,r,i){let l=Zt(t,n,i),s=pt(r).move_origin_text("center-right").translate(l.get_anchor("center-left")).translate(e(-((null==i?void 0:i.tick_label_offset)||0),0)).textfill("gray").append_tags(a.GRAPH_TICK_LABEL);return d(l,s)}function Qt(t,e){let n=e-t,r=Math.floor(Math.log10(n)),i=[.1,.15,.2,.5,1].map((t=>t*Math.pow(10,r))),a=i.map((t=>Math.floor(n/t)));for(let t=0;t<a.length;t++)if(a[t]<=10)return i[t];return i.slice(-1)[0]}function te(t,e,n=!0){return n&&t<0&&e>0?function(t,e,n=!0){if(t>0)throw new Error("neg must be negative");if(e<0)throw new Error("pos must be positive");let r=Math.max(-t,e),i=Qt(-r,r),a=Math.ceil(t/i)*i,l=Math.floor(e/i)*i,s=A(a,l,Math.floor((l-a)/i)+1),o=-Math.floor(Math.log10(i));return o>=0&&(s=s.map((t=>parseFloat(t.toFixed(o))))),n?s.filter((t=>0!=t)):s}(t,e):function(t,e){let n=Qt(t,e),r=Math.round(t/n)*n,i=Math.round(e/n)*n,a=L(0,Math.round((i-r)/n)).map((t=>r+t*n)),l=-Math.floor(Math.log10(n)-1);return l>=0&&(a=a.map((t=>parseFloat(t.toFixed(l))))),a}(t,e)}function ee(t,e=0,n=!1){let r=Object.assign(Object.assign({},Vt),t);return null==r.xticks&&(r.xticks=te(r.xrange[0],r.xrange[1],0==e)),r.xticks=r.xticks.filter((t=>t>r.xrange[0]&&t<r.xrange[1])),d(...n?r.xticks.map((t=>Kt(t,e,r))):r.xticks.map((t=>Yt(t,e,t.toString(),r))))}function ne(t,e=0,n=!1){let r=Object.assign(Object.assign({},Vt),t);return null==r.yticks&&(r.yticks=te(r.yrange[0],r.yrange[1],0==e)),r.yticks=r.yticks.filter((t=>t>r.yrange[0]&&t<r.yrange[1])),d(...n?r.yticks.map((t=>Zt(t,e,r))):r.yticks.map((t=>Jt(t,e,t.toString(),r))))}function re(t){let e=Object.assign(Object.assign({},Vt),t),n=e.xrange[0],r=e.yrange[0];return d($t(e),ee(e,r),ne(e,n))}function ie(t){let e=Object.assign(Object.assign({},Vt),t);return d(Ft(e),ee(e),ne(e))}function ae(t){let n=Object.assign(Object.assign({},Vt),t);if(null==n.bbox){let[t,r]=n.xrange,[i,a]=n.yrange;n.bbox=[e(t,i),e(r,a)]}let r=Ut(n)(e(0,0));return d(gt(e(n.bbox[0].x,r.y),e(n.bbox[1].x,r.y),n.headsize).append_tags(a.GRAPH_AXIS),ee(n,0))}function le(t){let n=Object.assign(Object.assign({},Vt),t);if(null==n.bbox){let[t,r]=n.xrange,[i,a]=n.yrange;n.bbox=[e(t,i),e(r,a)]}let r=Ut(n)(e(0,0));return d(gt(e(r.x,n.bbox[0].y),e(r.x,n.bbox[1].y),n.headsize).append_tags(a.GRAPH_AXIS),ne(n,0))}function se(t){let n=Object.assign(Object.assign({},Vt),t);return null==n.xticks&&(n.xticks=te(n.xrange[0],n.xrange[1],!1)),d(...n.xticks.map((t=>p(e(t,n.yrange[0]),e(t,n.yrange[1])).transform(Ut(n)).stroke("gray")))).append_tags(a.GRAPH_GRID)}function oe(t){let n=Object.assign(Object.assign({},Vt),t);return null==n.yticks&&(n.yticks=te(n.yrange[0],n.yrange[1],!1)),d(...n.yticks.map((t=>p(e(n.xrange[0],t),e(n.xrange[1],t)).transform(Ut(n)).stroke("gray")))).append_tags(a.GRAPH_GRID)}function ce(t){let n=Object.assign(Object.assign({},Vt),t);return null==n.xticks&&(n.xticks=te(n.xrange[0],n.xrange[1],!1)),null==n.yticks&&(n.yticks=te(n.yrange[0],n.yrange[1],!1)),d(...n.xticks.map((t=>p(e(t,n.yrange[0]),e(t,n.yrange[1])).transform(Ut(n)).stroke("gray"))),...n.yticks.map((t=>p(e(n.xrange[0],t),e(n.xrange[1],t)).transform(Ut(n)).stroke("gray"))))}function he(t,e){let n,r=Object.assign(Object.assign({},Vt),e),[i,a]=r.xrange,[l,s]=r.yrange,o=[],c=[];for(let e=0;e<t.length;e++){let n=t[e];n.x>=i&&n.x<=a&&n.y>=l&&n.y<=s?c.push(n):(c.length>1&&o.push(c),c=[])}c.length>1&&o.push(c);let h=o.map((t=>g(t)));return n=1==h.length?h[0]:d(...h).stroke("black").fill("none"),n.transform(Ut(r))}function ue(t,n,r){if(t.length!=n.length)throw new Error("xdata and ydata must have the same length");return he(t.map(((t,r)=>e(t,n[r]))),r)}function de(t,n){let r=Object.assign(Object.assign({},Vt),n);return he(A(...r.xrange,r.n_sample).map((n=>e(n,t(n)))),n)}function ge(t,n,r,i){let a=Object.assign(Object.assign({},Vt),i),l=Object.assign({},a);return l.xrange=[n,r],l.bbox=void 0,de(t,l).add_points([e(r,0),e(n,0)]).to_polygon().transform(Ut(a))}var pe=Object.freeze({__proto__:null,ax:Xt,axes_corner_empty:$t,axes_corner_empty_xbreak:Wt,axes_empty:Ft,axes_transform:Ut,default_axes_options:Vt,get_tick_numbers:te,plot:ue,plotf:de,plotv:he,under_curvef:ge,xaxis:ae,xgrid:oe,xtickmark:Yt,xtickmark_empty:Kt,xticks:ee,xyaxes:ie,xycorneraxes:re,xycorneraxes_xbreak:function(t){let e=Object.assign(Object.assign({},Vt),t),n=e.xrange[0],r=e.yrange[0];return d(Wt(e),ee(e,r),ne(e,n))},xygrid:ce,yaxis:le,ygrid:se,ytickmark:Jt,ytickmark_empty:Zt,yticks:ne});function _e(t,n,r=1,i){let[a,l,s]=t,o=a.sub(l),c=s.sub(l);if(null==i&&(i=e(0,0)),"number"==typeof i){i=o.normalize().add(c.normalize()).normalize().scale(i)}let h=o.angle(),u=c.angle();u<h&&(u+=2*Math.PI);let g=ht(r,u-h).rotate(h).add_points([e(0,0)]).to_polygon();return""==n||null==n?g.position(l):d(g,pt(n).translate(i)).position(l)}var fe=Object.freeze({__proto__:null,angle:_e,angle_smaller:function(t,e,n=1,r){let[i,a,l]=t,s=i.sub(a),o=l.sub(a),c=s.angle(),h=o.angle();return h<c&&(h+=2*Math.PI),_e(h-c>Math.PI?[l,a,i]:[i,a,l],e,n,r)},congruence_mark:function(t,n,r,i=1,a){let l=n.sub(t),s=Math.atan2(l.x,-l.y),o=t.add(n).scale(.5);a=null!=a?a:i/2;let c=[];for(let t=0;t<r;t++){let n=p(e(-i/2,t*a),e(i/2,t*a));c.push(n)}return d(...c).rotate(s).move_origin("center-center").position(o)},length:function(t,n,r,i,a,l,s=!0){a=null!=a?a:n.sub(t).length()/20,l=null!=l?l:2*i;let o=t.equals(n)?e(0,0):n.sub(t).normalize(),c=e(o.y,-o.x),h=t.add(c.scale(i)),u=n.add(c.scale(i)),g=s?p(h.sub(c.scale(a/2)),h.add(c.scale(a/2))):p(h,h.sub(c.scale(a))),_=s?p(u.sub(c.scale(a/2)),u.add(c.scale(a/2))):p(u,u.sub(c.scale(a))),f=d(p(h,u),g,_),m=t.add(n).scale(.5);return d(f,pt(r).position(m.add(c.scale(l))))},parallel_mark:function(t,n,r,i=1,a,l=.5){let s=n.sub(t),o=Math.atan2(s.x,-s.y),c=t.add(n).scale(.5);a=null!=a?a:i/2;let h=[],u=i/2*Math.cos(l);for(let t=0;t<r;t++){let n=e(0,t*a-u),r=p(e(-i/2,t*a),n),l=p(e(i/2,t*a),n);h.push(r.combine(l))}return d(...h).rotate(o).move_origin("center-center").position(c)},right_angle:function(t,n=1){let[r,i,a]=t,l=r.sub(i).normalize().scale(n).add(i),s=a.sub(i).normalize().scale(n).add(i);return g([l,e(l.x,s.y),s])},vector:function(t,n,r,i){null==r&&(r=e(0,0));let a=ut(t,i);return""==n||null==n?a:d(a,pt(n).position(t.add(r)))}});var me=Object.freeze({__proto__:null,inclined_plane:function(t,n){return _([e(0,0),e(t,t*Math.tan(n)),e(t,0)])},spring:function(t,n,r=1,i=10,a=.5,l=100){let s=n.sub(t).angle(),o=n.sub(t).length(),c=a,h=r/c,u=(2*i+1)*Math.PI,d=(o-2*c)/u;return g(A(0,u,l).map((t=>e(d*t+c-c*Math.cos(t),h*c*Math.sin(t))))).rotate(s).translate(t)}});let be={gap:.1,ticksize:.2,bbox:[e(0,0),e(10,10)]};function ve(t,n){var r,i;let a=Object.assign(Object.assign({},be),n),l=t.length,s=Math.max(...t),o=null!==(r=a.yrange)&&void 0!==r?r:[0,s],c=null!==(i=a.bbox)&&void 0!==i?i:[e(0,0),e(10,s)];return{xrange:[-1,l],yrange:o,headsize:0,ticksize:a.ticksize,bbox:c}}var ye=Object.freeze({__proto__:null,axes_tansform:function(t,e={}){return Ut(ve(t,Object.assign(Object.assign({},be),e)))},default_bar_options:be,plot:function(t,n={}){let r=Object.assign(Object.assign({},be),n),i=Ut(ve(t,r));return d(...t.map(((t,n)=>it(1-r.gap,t).move_origin("bottom-center").position(e(Number(n),0)).transform(i))))},xaxes:function(t,n={}){let r=Object.assign(Object.assign({},be),n),i=t.length,a=Ut(ve(t.map((()=>1)),r));return d(p(e(-1,0),e(i,0)).transform(a).stroke("gray"),...t.map(((t,n)=>m(t).move_origin_text("top-center").position(e(Number(n),0)).transform(a).translate(e(0,-r.ticksize/2)).textfill("gray"))))},yaxes:function(t,n={}){var r;let i=Object.assign(Object.assign({},be),n),a=ve(t,i),l=a.yrange[1],s=null!==(r=i.yrange)&&void 0!==r?r:[0,l],o=Ut(a),c=p(e(-1,0),e(-1,s[1])).transform(o).stroke("gray");return ne(a,-1).combine(c)}});var xe,we=Object.freeze({__proto__:null,axis:function(t,n,r=1){return gt(e(t,0),e(n,0),r).fill("black").append_tags(a.GRAPH_AXIS)},numbered_ticks:function(t,n,r){let i=[];for(let l of t){let t=p(e(l,-n/2),e(l,n/2)).stroke("black").append_tags(a.GRAPH_TICK),s=m(l.toString()).move_origin("top-center").position(e(l,-n/2-r)).append_tags(a.GRAPH_TICK_LABEL);i.push(d(t,s))}return d(...i)},single_tick:function(t,n,r,i){let l=p(e(t,-r/2),e(t,r/2)).stroke("black").append_tags(a.GRAPH_TICK);return""==n?l:d(l,m(n).move_origin("top-center").position(e(t,-r/2-i)).append_tags(a.GRAPH_TICK_LABEL))},ticks:function(t,n){let r=[];for(let i of t){let t=p(e(i,-n/2),e(i,n/2)).stroke("black").append_tags(a.GRAPH_TICK);r.push(t)}return d(...r)}});function ke(t,e,n,r=xe.ROWS){let i=r==xe.ROWS?t:S(t),l=i.length,s=Math.max(...i.map((t=>t.length))),o=Ae(l,s,e,n),c=Ee(o),h=[];for(let t=0;t<l;t++)for(let e=0;e<s;e++){let n=i[t][e];null!=n&&(n=n.move_origin("center-center").position(c[t][e]).append_tags(a.TABLE_CONTENT).append_tags(a.ROW_+t).append_tags(a.COL_+e),h.push(n))}let u=d(...h);return d(o,u).append_tags(a.CONTAIN_TABLE)}function Ae(t,n,r,i){for(;r.length<t;)r.push(r[r.length-1]);for(;i.length<n;)i.push(i[i.length-1]);let l=[],s=0;for(let o=0;o<t;o++){let t=s-r[o],c=0,h=[];for(let r=0;r<n;r++){let n=c+i[r],l=(c+n)/2,u=(s+t)/2,d=at(e(c,t),e(n,s)).move_origin(e(l,u)).append_tags(a.TABLE_CELL).append_tags(a.ROW_+o).append_tags(a.COL_+r);h.push(d),c=n}l.push(d(...h)),s=t}return d(...l).append_tags(a.TABLE)}function Ee(t){let e=t;if(t.tags.includes(a.CONTAIN_TABLE))for(let n of t.children)if(n.tags.includes(a.TABLE)){e=n;break}if(!e.tags.includes(a.TABLE))return[];let n=[];for(let t of e.children){let e=[];for(let n of t.children)e.push(n.origin);n.push(e)}return n}!function(t){t.ROWS="rows",t.COLUMNS="columns"}(xe||(xe={}));var Oe=Object.freeze({__proto__:null,empty_fixed_size:Ae,fixed_size:ke,get_points:Ee,style_cell:function t(e,n){let r=e.copy();if(e.tags.includes(a.CONTAIN_TABLE)){let e=r.children.findIndex((t=>t.tags.includes(a.TABLE))),i=t(r.children[e],n);return r.children[e]=i,r}if(!e.tags.includes(a.TABLE))return e;for(let t of n){let[e,n]=t.index,i=r.children[e].children[n];t.fill&&(i=i.fill(t.fill)),t.stroke&&(i=i.stroke(t.stroke)),t.strokewidth&&(i=i.strokewidth(t.strokewidth)),r.children[e].children[n]=i}return r},table:function(t,e=0,n=xe.ROWS,r=0,i=0){let a=n==xe.ROWS?t:S(t);const l=N(e);function s(t){if(null==t)return[i,r];let[e,n]=t.bounding_box();return[n.x-e.x+l[1]+l[3],n.y-e.y+l[0]+l[2]]}let o=a.length,c=Math.max(...a.map((t=>t.length))),h=Array(o).fill(r),u=Array(c).fill(i);for(let t=0;t<o;t++)for(let e=0;e<c;e++){let[n,r]=s(a[t][e]);h[t]=Math.max(h[t],r),u[e]=Math.max(u[e],n)}return ke(t,h,u,n)}});let Le={ticksize:.2,range:[0,1],bbox:[e(0,0),e(10,10)],orientation:"x",headsize:.05,tick_label_offset:0};function Se(t){var n;let r=Object.assign(Object.assign({},Le),t);if(r.bbox=null!==(n=r.bbox)&&void 0!==n?n:[e(0,0),e(10,10)],"x"==r.orientation){return{xrange:r.range,yrange:[r.bbox[0].y,r.bbox[1].y],xticks:r.ticks,headsize:r.headsize,ticksize:r.ticksize,bbox:r.bbox,tick_label_offset:r.tick_label_offset}}return{xrange:[r.bbox[0].x,r.bbox[1].x],yrange:r.range,yticks:r.ticks,headsize:r.headsize,ticksize:r.ticksize,bbox:r.bbox,tick_label_offset:r.tick_label_offset}}var Ne,Me=Object.freeze({__proto__:null,axes:function(t={}){let n=Object.assign(Object.assign({},Le),t),r=Se(n),[i,a]=n.bbox;if("x"==n.orientation){return d(gt(e(i.x,0),e(a.x,0),n.headsize),ee(r,0)).stroke("gray").fill("gray")}return d(gt(e(0,i.y),e(0,a.y),n.headsize),ne(r,0)).stroke("gray").fill("gray")},default_bar_options:Le,empty_tickmarks:function(t,e={}){let n=Object.assign(Object.assign({},Le),e),r=Se(n);return"x"==n.orientation?(r.xticks=t,ee(r,0,!0)):(r.yticks=t,ne(r,0,!0))},plotQ:function(t,n,r,i){let a=Object.assign(Object.assign({},Le),i),l=Ut(Se(a)),[s,o,c,h,u]=t,g=.8*r;if("x"==a.orientation){return d(it(h-o,r).move_origin("center-left").position(e(o,n)).transform(l),p(e(s,n-g/2),e(s,n+g/2)).transform(l),p(e(u,n-g/2),e(u,n+g/2)).transform(l),p(e(c,n-r/2),e(c,n+r/2)).transform(l),p(e(s,n),e(o,n)).transform(l),p(e(h,n),e(u,n)).transform(l))}return d(it(r,h-o).move_origin("bottom-center").position(e(n,o)).transform(l),p(e(n-g/2,s),e(n+g/2,s)).transform(l),p(e(n-g/2,u),e(n+g/2,u)).transform(l),p(e(n-r/2,c),e(n+r/2,c)).transform(l),p(e(n,s),e(n,o)).transform(l),p(e(n,h),e(n,u)).transform(l))},to_ax_options:Se});function Ce(t,n){let r=t.p,i=t.p.add(t.dir),a=n.p,l=n.p.add(n.dir),s=r.x,o=r.y,c=i.x,h=i.y,u=a.x,d=a.y,g=l.x,p=l.y,_=(s-c)*(d-p)-(o-h)*(u-g);return e(((s*h-o*c)*(u-g)-(s-c)*(u*p-d*g))/_,((s*h-o*c)*(d-p)-(o-h)*(u*p-d*g))/_)}function Te(t,e){return{type:Ne.LINE,p:t,dir:e}}function ze(t,e){return Te(t,e.sub(t))}function je(t,n){let[r,i]=n,a=r,l=i,s=e(a.x,l.y),o=e(l.x,a.y),c=[Ce(t,ze(s,l)),Ce(t,ze(l,o)),Ce(t,ze(o,a)),Ce(t,ze(a,s))];const h=1e-6;let u=c.filter((t=>(t=>t.x>=a.x-h&&t.x<=l.x+h&&t.y>=a.y-h&&t.y<=l.y+h)(t)));if(!(u.length<=1))return p(u[0],u[1])}!function(t){t.LINE="LINE"}(Ne||(Ne={}));var De=Object.freeze({__proto__:null,get_preview_diagram:function(n,r){let i=[],a=[],l={[Ne.LINE]:a},s=Object.keys(n);for(let e of s){let r=n[e];"number"!=typeof r&&(r instanceof t?i.push({name:e,p:r}):l[r.type].push({name:e,obj:r}))}let o=Math.min(...i.map((t=>t.p.x))),c=Math.max(...i.map((t=>t.p.x))),h=Math.min(...i.map((t=>t.p.y))),u=Math.max(...i.map((t=>t.p.y)));null==r&&(r=.1*Math.max(c-o,u-h));let g=[e(o-(r=function(t){let e="number"==typeof t?[t]:t;switch(e.length){case 0:return[0,0,0,0];case 1:return[e[0],e[0],e[0],e[0]];case 2:return[e[0],e[1],e[0],e[1]];case 3:return[e[0],e[1],e[2],e[1]];default:return[e[0],e[1],e[2],e[3]]}}(r))[0],h-r[1]),e(c+r[2],u+r[3])],p=a.map((t=>je(t.obj,g))).filter((t=>void 0!==t)),_=.01*Math.max(g[1].x-g[0].x,g[1].y-g[0].y)*2/3;return d(...p,...i.map((t=>{let n=ct(_).translate(t.p).fill("black"),r=pt(t.name).translate(t.p.add(e(2*_,2*_))).move_origin_text("bottom-left"),i=r.copy().textfill("white").textstroke("white").textstrokewidth(10).opacity(.7);return n.combine(i,r)})))},intersect:function(t,e){if(t.type===Ne.LINE&&e.type===Ne.LINE){return[Ce(t,e)]}return[]},line:Te,line_from_angle:function(t,e){return Te(t,n(e))},line_from_points:ze,line_from_slope:function(t,n){return Te(t,e(1,n))},line_intersection:Ce,line_parallel_at_point:function(t,e){return Te(e,t.dir)},line_perpendicular_at_point:function(t,n){return Te(n,e(-t.dir.y,t.dir.x))},line_rotated_at_point:function(t,e,n){return Te(n,t.dir.rotate(e))},point_collinear_extend_length:function(t,e,n){let r=e.sub(t).normalize();return e.add(r.scale(n))},point_collinear_fraction:function(t,e,n){let r=e.sub(t);return t.add(r.scale(n))},point_onLine_atDistance_from:function(t,e,n){let r=t.dir.normalize();return n.add(r.scale(e))},point_onLine_with_x:function(t,n){let r=t.dir.y/t.dir.x;return e(n,r*n+(t.p.y-r*t.p.x))},point_onLine_with_y:function(t,n){let r=t.dir.y/t.dir.x;return e((n-(t.p.y-r*t.p.x))/r,n)}});class He{constructor(t,e,n=0,r=0){var i;this.diagram=t.value,this.size=mt(this.diagram),this.x=-1,this.y=n,this.tree=t;let a=null!==(i=t.children)&&void 0!==i?i:[];this.children=a.map(((t,e)=>new He(t,this,n+1,e))),this.parent=e,this.thread=void 0,this.mod=0,this.ancestor=this,this.change=0,this.shift=0,this.number=r}left(){return this.thread?this.thread:this.children.length>0?this.children[0]:void 0}right(){return this.thread?this.thread:this.children.length>0?this.children[this.children.length-1]:void 0}lsibling(){if(this.parent)return this.number>0?this.parent.children[this.number-1]:void 0}}function Ie(t,e,n){let r=Pe(new He(t,void 0),n),i=Ve(r,0,0,e,0);return i<0&&qe(r,-i),Re(r),r}function Re(t){t.diagram=t.diagram.position(e(t.x,t.y)),t.children.forEach(Re)}function qe(t,e){t.x+=e,t.children.forEach((t=>qe(t,e)))}function Pe(t,e){let n=t.size[0]/2;if(0===t.children.length){let r=t.lsibling();if(r){let i=r.size[0]/2+n+e;t.x=r.x+i}else t.x=0}else{let r=t.children[0];t.children.forEach((t=>{Pe(t,e),r=function(t,e,n){let r=t.lsibling();if(void 0!==r){let i=t,a=t,l=r,s=t.parent&&0!==t.number?t.parent.children[0]:void 0,o=t.mod,c=t.mod,h=l.mod,u=s.mod;for(;void 0!==(null==l?void 0:l.right())&&void 0!==(null==i?void 0:i.left());){l=l.right(),i=i.left(),s=null==s?void 0:s.left(),a=null==a?void 0:a.right(),a.ancestor=t;let r=l.size[0]/2+i.size[0]/2+n,d=l.x+h-(i.x+o)+r;if(d>0){Ge(Be(l,t,e),t,d),o+=d,c+=d}h+=l.mod,o+=i.mod,u+=s.mod,c+=a.mod}void 0!==l.right()&&void 0===a.right()?(a.thread=l.right(),a.mod+=h-c):(void 0!==(null==i?void 0:i.left())&&void 0===(null==s?void 0:s.left())&&(s.thread=i.left(),s.mod+=o-u),e=t)}return e}(t,r,e)})),function(t){let e=0,n=0;for(let r=t.children.length-1;r>=0;r--){let i=t.children[r];i.x+=e,i.mod+=e,n+=i.change,e+=i.shift+n}}(t);let i=(t.children[0].x+t.children[t.children.length-1].x)/2,a=t.lsibling();if(a){let r=a.size[0]/2+n+e;t.x=a.x+r,t.mod=t.x-i}else t.x=i}return t}function Ge(t,e,n){let r=e.number-t.number;e.change-=n/r,e.shift+=n,t.change+=n/r,e.x+=n,e.mod+=n}function Be(t,e,n){var r;return(null===(r=e.parent)||void 0===r?void 0:r.children.includes(t.ancestor))?t.ancestor:n}function Ve(t,e,n,r,i){return t.x+=e,t.y=-n*r,i=Math.min(null!=i?i:t.x,t.x),t.children.forEach((a=>{i=Ve(a,e+t.mod,n+1,r,i)})),i}function Ue(t){let e=t.diagram,n=t.children.map(Ue),r=t.children.map((t=>p(e.get_anchor("bottom-center"),t.diagram.get_anchor("top-center"))));return d(e,...r,...n)}var Xe=Object.freeze({__proto__:null,mirror_treenode:function t(e){var n;return{value:e.value,children:(null!==(n=e.children)&&void 0!==n?n:[]).map(t).reverse()}},tree:function(t,e,n){return Ue(Ie(t,e,n))}});function Fe(t,n=10){const r=t.length;let i=t.map((t=>t.y)),a=new Array(r).fill(0),l=new Array(r).fill(0),s=new Array(r-1);for(let e=0;e<r-1;e++)s[e]=t[e+1].x-t[e].x;let o=new Array(r-1).fill(0),c=new Array(r).fill(0),h=new Array(r).fill(1),u=new Array(r).fill(0),d=new Array(r).fill(0);for(let t=1;t<r-1;t++)o[t]=3/s[t]*(i[t+1]-i[t])-3/s[t-1]*(i[t]-i[t-1]);for(let e=1;e<r-1;e++)h[e]=2*(t[e+1].x-t[e-1].x)-s[e-1]*u[e-1],u[e]=s[e]/h[e],d[e]=(o[e]-s[e-1]*d[e-1])/h[e];for(let t=r-2;t>=0;t--)c[t]=d[t]-u[t]*c[t+1],a[t]=(i[t+1]-i[t])/s[t]-s[t]*(c[t+1]+2*c[t])/3,l[t]=(c[t+1]-c[t])/(3*s[t]);let g=[];for(let s=0;s<r-1;s++)for(let r=0;r<=n;r++){let o=t[s].x+r*(t[s+1].x-t[s].x)/n,h=i[s]+a[s]*(o-t[s].x)+c[s]*Math.pow(o-t[s].x,2)+l[s]*Math.pow(o-t[s].x,3);g.push(e(o,h))}return g}var $e=Object.freeze({__proto__:null,bezier_cubic:function(t,e,n,r,i=100){const a=1/(i-1),l=Array(i);for(let s=0;s<i;s++){const i=s*a,o=t.scale((1-i)*(1-i)*(1-i)),c=e.scale(3*i*(1-i)*(1-i)),h=n.scale(3*i*i*(1-i)),u=r.scale(i*i*i);l[s]=o.add(c).add(h).add(u)}return g(l)},bezier_quadratic:function(t,e,n,r=100){const i=1/(r-1),a=Array(r);for(let l=0;l<r;l++){const r=l*i,s=t.scale((1-r)*(1-r)),o=e.scale(2*r*(1-r)),c=n.scale(r*r);a[l]=s.add(o).add(c)}return g(a)},cubic_spline:function(t,e=10){return g(Fe(t,e))},curve_combine:function(...t){return g(t.map((t=>{var e,n;return null!==(n=null===(e=t.path)||void 0===e?void 0:e.points)&&void 0!==n?n:[]})).flat())},interpolate_cubic_spline:Fe});var We=Object.freeze({__proto__:null,decode:function(t){return decodeURIComponent(atob(t))},encode:function(t){return btoa(encodeURIComponent(t))}});export{h as Diagram,Mt as Interactive,u as Path,a as TAG,e as V2,n as Vdir,t as Vector2,q as _init_default_diagram_style,G as _init_default_text_diagram_style,V as _init_default_textdata,yt as align_horizontal,vt as align_vertical,fe as annotation,ht as arc,k as array_repeat,ut as arrow,dt as arrow1,gt as arrow2,Xt as ax,$t as axes_corner_empty,Ft as axes_empty,Ut as axes_transform,ye as bar,Me as boxplot,ct as circle,zt as clientPos_to_svgPos,g as curve,$e as curves,R as default_diagram_style,P as default_text_diagram_style,B as default_textdata,d as diagram_combine,Et as distribute_grid_row,xt as distribute_horizontal,kt as distribute_horizontal_and_align,Ot as distribute_variable_row,wt as distribute_vertical,At as distribute_vertical_and_align,rt as download_svg_as_png,nt as download_svg_as_svg,Z as draw_to_svg,J as draw_to_svg_element,f as empty,We as encoding,De as geo_construct,bt as geometry,Dt as get_SVGPos_from_event,K as get_tagged_svg_element,pe as graph,et as handle_tex_in_svg,b as image,p as line,A as linspace,E as linspace_exc,me as mechanics,Bt as mod,v as multiline,y as multiline_bb,we as numberline,ue as plot,de as plotf,he as plotv,_ as polygon,O as range,L as range_inc,it as rectangle,at as rectangle_corner,st as regular_polygon,ot as regular_polygon_side,U as reset_default_styles,lt as square,H as str_latex_to_unicode,I as str_to_mathematical_italic,Oe as table,m as text,pt as textvar,w as to_degree,x as to_radian,S as transpose,Xe as tree,ge as under_curvef,M as utils,ae as xaxis,oe as xgrid,Yt as xtickmark,Kt as xtickmark_empty,ee as xticks,ie as xyaxes,re as xycorneraxes,ce as xygrid,le as yaxis,se as ygrid,Jt as ytickmark,Zt as ytickmark_empty,ne as yticks};
//# sourceMappingURL=diagramatics.min.js.map
